(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{148:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return _})),t.d(n,"metadata",(function(){return D})),t.d(n,"toc",(function(){return N})),t.d(n,"default",(function(){return H}));var r=t(3),i=t(7),o=t(0),a=t.n(o),c=t(159),s=t(185),u=t(164),l=t(4),d=t(160),f=t(163),h=t(181),m=t(293),p=t(294),b=t(295),g=t(194),v=t(290),y=t(180),w=t(187),j=t(202),O=t(291),E=function(){var e=this;Object(d.a)(this,"config",void 0),Object(d.a)(this,"nodes",void 0),Object(d.a)(this,"connections",void 0),Object(d.a)(this,"population",void 0),this.config=Object.assign({},O.b,{populationSize:100,adjustCompatibilityThreshold:!0,compatibilityModifierTarget:30,feedForwardOnly:!1}),this.nodes=[new O.c(O.d.Input,"foodOffsetX"),new O.c(O.d.Input,"foodOffsetY"),new O.c(O.d.Hidden,"hidden1"),new O.c(O.d.Hidden,"hidden2"),new O.c(O.d.Hidden,"hidden3"),new O.c(O.d.Output,"turnAmount"),new O.c(O.d.Output,"thrustAmount")],this.connections=[],this.nodes.filter((function(e){return e.type!==O.d.Output})).forEach((function(n,t){e.connections.push(new O.a(t,n,e.nodes[e.nodes.length-2]),new O.a(t,n,e.nodes[e.nodes.length-1]))})),this.population=O.e.from(this.config,{nodes:this.nodes,connections:this.connections})},S=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return n=e.call.apply(e,[this].concat(r))||this,Object(d.a)(Object(u.a)(n),"amount",0),n}return Object(l.a)(n,e),n}(f.Facet),T=function(e){var n=e.speed,t=Object(f.useQuery)((function(e){return e.hasAll(h.a,S)}));return Object(f.useSystem)((function(e){t.loop([h.a,S],(function(t,r){var i=r[0],o=r[1].amount;i.object3d.rotation.y+=o*e*n}))}))},x=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return n=e.call.apply(e,[this].concat(r))||this,Object(d.a)(Object(u.a)(n),"amount",0),n}return Object(l.a)(n,e),n}(f.Facet),k=function(e){var n=e.speed,t=Object(f.useQuery)((function(e){return e.hasAll(h.a,S,x)}));return Object(f.useSystem)((function(e){t.loop([h.a,S,x],(function(t,r){var i=r[0],o=(r[1],r[2]);i.object3d.translateZ(o.amount*e*n)}))}))},z=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return n=e.call.apply(e,[this].concat(r))||this,Object(d.a)(Object(u.a)(n),"direction",void 0),n}return Object(l.a)(n,e),n}(f.Facet),M=function(){var e=Object(f.useQuery)((function(e){return e.hasAll(h.a,F)})),n=Object(f.useQuery)((function(e){return e.hasAll(h.a,V)}));return Object(f.useSystem)((function(t){n.loop([h.a,z],(function(n,t){var r=t[0],i=t[1],o=void 0;e.loop([h.a,F],(function(e,n){var t=n[0],i=(n[1],r.object3d.position.distanceTo(t.object3d.position));(void 0===o||i<o.dist)&&(o={dist:i,view:t})})),i.direction=o.view.object3d.position.clone().sub(r.object3d.position).normalize()}))}))},C=function(e){new y.Vector3(0,2*Math.random()-1,0).normalize();return a.a.createElement(f.Entity,null,a.a.createElement(z,null),a.a.createElement(V,null),a.a.createElement(S,null),a.a.createElement(x,null),a.a.createElement(j.a,null),a.a.createElement(h.a,null,a.a.createElement(m.a,{position:e.position,scale:[1,1,2],castShadow:!0,receiveShadow:!0},a.a.createElement("meshPhongMaterial",{color:"green"}))))},A=function(){var e=Object(o.useRef)();return Object(p.a)(e,y.DirectionalLightHelper,"royalblue",1),Object(p.a)(e,y.DirectionalLightShadow),a.a.createElement("directionalLight",{ref:e,position:[10,10,10],castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":100,"shadow-camera-left":-100,"shadow-camera-right":100,"shadow-camera-top":100,"shadow-camera-bottom":-100})},V=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return n=e.call.apply(e,[this].concat(r))||this,Object(d.a)(Object(u.a)(n),"organism",void 0),Object(d.a)(Object(u.a)(n),"network",void 0),n}return Object(l.a)(n,e),n}(f.Facet),R=function(){var e=Object(o.useRef)(),n=Object(o.useRef)(0),t=Object(o.useRef)(0),r=Object(f.useQuery)((function(e){return e.hasAll(V,h.a,S,x)})),i=function(){if(console.log("Resetting to tick 0."),n.current=0,t.current>0){console.log("New epoch: "+t.current+".");var i=e.current.population.getSuperChamp();console.log("Fitness: "+i.originalFitness),e.current.population.epoch(),console.log("Population: "+e.current.population.organisms.length)}e.current.population.getSuperChamp().getNetwork().neurons.values(),r.loop([V,h.a,S,x],(function(n,t,r){var i=t[0],o=t[1],a=t[2],c=t[3];o.object3d.material.color=new y.Color("green"),i.organism=e.current.population.organisms[r],i.organism?(i.network=i.organism.getNetwork(),o.object3d.scale.set(1,1,2),o.object3d.position.set(200*Math.random()-100,0,200*Math.random()-100)):(i.network=void 0,a.amount=0,c.amount=0,o.object3d.position.set(0,1e4,0))})),t.current++};return Object(o.useEffect)((function(){e.current=new E,i()}),[]),Object(f.useSystem)((function(e){n.current>500&&i(),r.loop([V,z,S,x],(function(e,n){var t=n[0],r=n[1],i=n[2],o=n[3];if(!t.network)return i.amount=0,void(o.amount=0);var a=t.network.activate([1,r.direction.x,r.direction.y]),c=a[0],s=a[1];i.amount=2*c.value-1,o.amount=2*s.value-1})),n.current++}))},F=function(e){function n(){return e.apply(this,arguments)||this}return Object(l.a)(n,e),n}(f.Facet),P=function(){var e=Object(f.useQuery)((function(e){return e.hasAll(h.a,F)})),n=Object(f.useQuery)((function(e){return e.hasAll(h.a,V)}));return Object(f.useSystem)((function(t){n.loop([h.a,V],(function(n,t){var r=t[0],i=t[1];e.loop([h.a,F],(function(e,n){var t=n[0];n[1];r.object3d.position.distanceTo(t.object3d.position)<1&&(i.organism.fitness++,r.object3d.material.color.b+=10,r.object3d.scale.z+=1,t.object3d.position.set(200*Math.random()-100,0,200*Math.random()-100))}))}))}))},Q=function(){var e=Object(f.useECS)();return Object(f.useAnimationFrame)(e.update),a.a.createElement(g.a,{shadows:!0},a.a.createElement(A,null),a.a.createElement(b.a,{minDistance:30,maxPolarAngle:Object(f.rad)(60),minPolarAngle:Object(f.rad)(20)}),a.a.createElement(m.a,{scale:[200,1,200],position:[0,-1,0],receiveShadow:!0},a.a.createElement("meshPhongMaterial",{color:"lightblue"})),a.a.createElement(e.Provider,null,a.a.createElement(M,null),a.a.createElement(R,null),a.a.createElement(T,{speed:1}),a.a.createElement(k,{speed:5}),a.a.createElement(P,null),a.a.createElement(w.c,{showBounds:!0,size:100}),v.times(500,(function(e){return a.a.createElement(f.Entity,null,a.a.createElement(F,null),a.a.createElement(h.a,null,a.a.createElement(m.b,{position:[200*Math.random()-100,0,200*Math.random()-100]},a.a.createElement("meshPhongMaterial",{color:"blue"}))))})),v.times(100,(function(e){return a.a.createElement(C,{position:[200*Math.random()-100,0,200*Math.random()-100]})}))))},_={sidebar_position:3,sidebar_label:"Eater Experiment",title:"Eater Experiment"},D={unversionedId:"three/EaterExample",id:"three/EaterExample",isDocsHomePage:!1,title:"Eater Experiment",description:"",source:"@site/examples/three/EaterExample.md",sourceDirName:"three",slug:"/three/EaterExample",permalink:"/examples/three/EaterExample",version:"current",sidebar_label:"Eater Experiment",sidebarPosition:3,frontMatter:{sidebar_position:3,sidebar_label:"Eater Experiment",title:"Eater Experiment"},sidebar:"mySidebar",previous:{title:"Boids",permalink:"/examples/three/BoidExample"}},N=[],B={toc:N};function H(e){var n=e.components,t=Object(i.a)(e,["components"]);return Object(c.b)("wrapper",Object(r.a)({},B,t,{components:n,mdxType:"MDXLayout"}),Object(c.b)(s.a,{code:"import { Organism } from '@alenaksu/neatjs';\nimport Network from '@alenaksu/neatjs/dist-types/network/Network';\nimport {\n    Entity,\n    Facet,\n    rad,\n    useAnimationFrame,\n    useECS,\n    useQuery,\n    useSystem\n} from '@react-ecs/core';\nimport { ThreeView } from '@react-ecs/three';\nimport {\n    Box,\n    OrbitControls,\n    Sphere,\n    useHelper\n} from '@react-three/drei';\nimport { Canvas } from '@react-three/fiber';\nimport * as _ from 'lodash';\nimport React, {\n    useEffect,\n    useRef\n} from 'react';\nimport {\n    Color,\n    DirectionalLightHelper,\n    DirectionalLightShadow,\n    Mesh,\n    MeshPhongMaterial,\n    Vector3\n} from 'three';\n\nimport { Teleporter } from '../../../../../libs/boids/src/facets';\nimport { Teleporting } from '../../../../../libs/boids/src/facets/Teleporting';\nimport { TeleportSystem } from '../../../../../libs/boids/src/systems';\nimport { EaterSim } from './sim';\n\nclass Turning extends Facet<Turning> {\n    amount?= 0;\n}\n\nconst TurningSystem = ({ speed }) => {\n    const query = useQuery(e => e.hasAll(ThreeView, Turning));\n    return useSystem((dt) => {\n        query.loop([ThreeView, Turning], (e, [view, turning]) => {\n            const amt = turning.amount;\n            const rot = view.object3d.rotation;\n            rot.y += amt * dt * speed;\n        })\n    })\n}\n\nclass Thrusting extends Facet<Thrusting> {\n    amount?= 0;\n}\n\nconst ThrustingSystem = ({ speed }) => {\n    const query = useQuery(e => e.hasAll(ThreeView, Turning, Thrusting));\n    return useSystem((dt) => {\n        query.loop([ThreeView, Turning, Thrusting], (e, [view, turn, thrust]) => {\n            view.object3d.translateZ(thrust.amount * dt * speed);\n        });\n    })\n}\n\nclass Sensing extends Facet<Sensing> {\n    direction?: Vector3\n}\n\nconst SensingSystem = () => {\n    const rewardQuery = useQuery(e => e.hasAll(ThreeView, Rewarding));\n    const eaterQuery = useQuery(e => e.hasAll(ThreeView, Thinking));\n\n    return useSystem(dt => {\n        eaterQuery.loop([ThreeView, Sensing], (_, [eaterView, sense]) => {\n            let closest: { dist: number, view: ThreeView } = undefined;\n            rewardQuery.loop([ThreeView, Rewarding], (e, [view, reward]) => {\n                const dist = eaterView.object3d.position.distanceTo(view.object3d.position);\n                if (closest === undefined || dist < closest.dist) {\n                    closest = { dist, view: view as ThreeView }\n                }\n            })\n            sense.direction =\n                closest.view.object3d.position\n                    .clone()\n                    .sub(eaterView.object3d.position)\n                    .normalize()\n        })\n\n    })\n}\n\nconst Eater = (props) => {\n    const turning = new Vector3(\n        0, Math.random() * 2 - 1, 0\n    ).normalize()\n    return (\n        <Entity>\n            <Sensing />\n            <Thinking />\n            <Turning />\n            <Thrusting />\n            <Teleporting />\n            <ThreeView>\n                <Box position={props.position} scale={[1, 1, 2]} castShadow receiveShadow>\n                    <meshPhongMaterial color=\"green\" />\n                </Box>\n            </ThreeView>\n\n        </Entity>\n    )\n}\n\nconst Scene = () => {\n    const lightRef = useRef()\n    useHelper(lightRef, DirectionalLightHelper, 'royalblue', 1)\n    useHelper(lightRef, DirectionalLightShadow, )\n    return (\n        <directionalLight\n            ref={lightRef}\n            position={[10, 10, 10]}\n            castShadow\n            shadow-mapSize-width={2048}\n            shadow-mapSize-height={2048}\n            shadow-camera-far={100}\n            shadow-camera-left={-100}\n            shadow-camera-right={100}\n            shadow-camera-top={100}\n            shadow-camera-bottom={-100}\n        />\n    );\n}\n\nclass Thinking extends Facet<Thinking> {\n    organism?: Organism;\n    network?: Network;\n}\n\nconst ThinkingSystem = () => {\n    const sim = useRef<EaterSim>()\n    const tick = useRef(0)\n    const generation = useRef(0)\n\n    const query = useQuery(e => e.hasAll(Thinking, ThreeView, Turning, Thrusting));\n\n    const reset = () => {\n        console.log(\"Resetting to tick 0.\")\n        tick.current = 0;\n\n        if (generation.current > 0) {\n            console.log(`New epoch: ${generation.current}.`)\n            const winner = sim.current.population.getSuperChamp();\n            console.log(`Fitness: ${winner.originalFitness}`);\n            sim.current.population.epoch()\n            console.log(`Population: ${sim.current.population.organisms.length}`)\n        }\n\n        const champ = sim.current.population.getSuperChamp();\n        champ.getNetwork().neurons.values();\n\n        query.loop([Thinking, ThreeView, Turning, Thrusting], (e, [brain, view, turn, thrust], i) => {\n            ((view.object3d as Mesh).material as MeshPhongMaterial).color = new Color('green');\n            brain.organism = sim.current.population.organisms[i];\n            if (brain.organism) {\n                brain.network = brain.organism.getNetwork();\n                view.object3d.scale.set(1, 1, 2)\n                view.object3d.position.set(\n                    Math.random() * 200 - 100,\n                    0,\n                    Math.random() * 200 - 100,\n                )\n            } else {\n                brain.network = undefined;\n                turn.amount = 0;\n                thrust.amount = 0;\n                view.object3d.position.set(0, 10000, 0);\n            }\n        })\n\n        generation.current++;\n    }\n\n    useEffect(() => {\n        sim.current = new EaterSim();\n        reset();\n    }, [])\n\n    return useSystem((dt) => {\n        if (tick.current > 500) {\n            reset()\n        }\n\n        query.loop([Thinking, Sensing, Turning, Thrusting], (e, [brain, sense, turn, thrust]) => {\n            if (!brain.network) {\n                turn.amount = 0;\n                thrust.amount = 0;\n                return;\n            }\n            const [ turnPower, thrustPower ] = brain.network.activate([\n                1, sense.direction.x, sense.direction.y\n            ])\n            // console.log(`turn: ${turnPower.value}, thrust: ${thrustPower.value}`)\n            turn.amount = turnPower.value * 2 - 1;\n            thrust.amount = thrustPower.value * 2 - 1;\n        })\n\n        tick.current++;\n    });\n}\n\nclass Rewarding extends Facet<Rewarding> { }\n\nconst RewardSystem = () => {\n    const rewardQuery = useQuery(e => e.hasAll(ThreeView, Rewarding));\n    const eaterQuery = useQuery(e => e.hasAll(ThreeView, Thinking));\n\n    return useSystem(dt => {\n        eaterQuery.loop([ThreeView, Thinking], (_, [eaterView, brain]) => {\n            rewardQuery.loop([ThreeView, Rewarding], (e, [rewardView, reward]) => {\n                if (eaterView.object3d.position.distanceTo(rewardView.object3d.position) < 1) {\n                    brain.organism.fitness ++;\n                    ((eaterView.object3d as Mesh).material as MeshPhongMaterial).color.b += 10\n                    eaterView.object3d.scale.z += 1;\n                    rewardView.object3d.position.set(\n                        Math.random() * 200 - 100,\n                        0,\n                        Math.random() * 200 - 100\n                    );\n                }\n            })\n        })\n    })\n}\n\n\nexport const EaterScene = () => {\n    const ECS = useECS()\n    useAnimationFrame(ECS.update)\n\n\n    return (\n        <Canvas shadows>\n            <Scene />\n            <OrbitControls\n                minDistance={30}\n                maxPolarAngle={rad(60)}\n                minPolarAngle={rad(20)} />\n            <Box scale={[200, 1, 200]} position={[0, -1, 0]} receiveShadow>\n                <meshPhongMaterial color='lightblue' />\n            </Box>\n            <ECS.Provider>\n                <SensingSystem />\n                <ThinkingSystem />\n                <TurningSystem speed={1} />\n                <ThrustingSystem speed={5} />\n                <RewardSystem />\n                <Teleporter showBounds size={100} />\n\n                {_.times(500, i => (\n                    <Entity>\n                        <Rewarding />\n                        <ThreeView>\n                            <Sphere position={[Math.random() * 200 - 100, 0, Math.random() * 200 - 100]}>\n                                <meshPhongMaterial color='blue' />\n                            </Sphere>\n                        </ThreeView>\n                    </Entity>\n                ))}\n\n                {_.times(100, i => (\n                    <Eater position={[Math.random() * 200 - 100, 0, Math.random() * 200 - 100]} />\n                ))}\n            </ECS.Provider>\n        </Canvas>\n    )\n}\n\n\n\n\n",style:{minHeight:"400px",padding:"1em"},mdxType:"Example"},Object(c.b)(Q,{mdxType:"EaterScene"})))}H.isMDXComponent=!0},161:function(e,n,t){"use strict";t.d(n,"b",(function(){return s})),t.d(n,"a",(function(){return u}));var r=t(160),i=t(0),o=t.n(i),a=t(173),c=t(166),s=Object(i.createContext)(null),u=function(){function e(e,n){var t=this;void 0===e&&(e=[]),void 0===n&&(n=[]),Object(r.a)(this,"engine",new a.Engine),Object(r.a)(this,"systems",new c.a),this.update=this.update.bind(this),this.Provider=this.Provider.bind(this),e.forEach((function(e){return t.systems.add(e)})),n.forEach((function(e){return t.engine.addEntity(e)}))}var n=e.prototype;return n.update=function(e){this.systems.update(e)},n.Provider=function(e){return o.a.createElement(s.Provider,{value:this},e.children)},e}()},162:function(e,n,t){"use strict";t.d(n,"a",(function(){return i})),t.d(n,"b",(function(){return o}));var r=t(0),i=Object(r.createContext)(null);function o(){var e=Object(r.useContext)(i);if(!e)throw new Error("Missing Entity instance in EntityContext!");return e}},163:function(e,n,t){"use strict";var r=t(177);t.d(n,"DOMView",(function(){return r.a})),t.d(n,"ECSContext",(function(){return r.b})),t.d(n,"Emitter",(function(){return r.c})),t.d(n,"Entity",(function(){return r.d})),t.d(n,"Facet",(function(){return r.e}));var i=t(171);t.d(n,"EntityContext",(function(){return i.a})),t.d(n,"useAnimationFrame",(function(){return i.b})),t.d(n,"useECS",(function(){return i.c})),t.d(n,"useEngine",(function(){return i.d})),t.d(n,"useFacet",(function(){return i.e})),t.d(n,"useQuery",(function(){return i.f})),t.d(n,"useSystem",(function(){return i.g}));var o=t(174);t.o(o,"rad")&&t.d(n,"rad",(function(){return o.rad}))},165:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(0),i=t(161),o=function(){return Object(r.useContext)(i.b).engine}},166:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var r=t(160),i=function(){function e(){Object(r.a)(this,"systems",void 0),this.systems=new Array}var n=e.prototype;return n.sort=function(){this.systems.sort((function(e,n){return e.priority-n.priority}))},n.add=function(e,n){void 0===n&&(n=0),this.systems.push({callback:e,priority:n}),this.sort()},n.remove=function(e){var n=this.systems.findIndex((function(n){return n.callback===e}));return n>-1&&(this.systems.splice(n,1),this.sort(),!0)},n.clear=function(){this.systems=[]},n.update=function(e){this.systems.forEach((function(n){return n.callback(e)}))},e}()},167:function(e,n,t){"use strict";t.d(n,"a",(function(){return a}));var r=t(182),i=t(4),o=t(173),a=function(e){function n(){return e.apply(this,arguments)||this}return Object(i.a)(n,e),n.prototype.loop=function(e,n){for(var t=0;t<this.entities.length;t++){for(var i,o=this.entities[t],a=[],c=Object(r.a)(e);!(i=c()).done;){var s=i.value,u=o.get(s);a.push(u)}n(o,a,t)}},n}(o.Query)},168:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var r=t(0);function i(e){var n=Object(r.useRef)(e),t=Object(r.useState)({current:e}),i=(t[0],t[1]);return[n,function(e){n.current=e,i({current:e})}]}},169:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(0),i=t(161),o=function(e,n){void 0===n&&(n=0);var t=Object(r.useContext)(i.b).systems;return Object(r.useEffect)((function(){return t.add(e,n),function(){t.remove(e)}}),[e,n]),null}},170:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(0),i=t(169),o=function(e,n){var t=Object(r.useRef)(0);Object(i.a)((function(r){t.current+=r,t.current>e&&(t.current=0,n())}))}},171:function(e,n,t){"use strict";t.d(n,"b",(function(){return i})),t.d(n,"c",(function(){return a})),t.d(n,"d",(function(){return c.a})),t.d(n,"a",(function(){return s.a})),t.d(n,"e",(function(){return u})),t.d(n,"f",(function(){return m})),t.d(n,"g",(function(){return p.a}));var r=t(0),i=function(e){var n=Object(r.useRef)(null),t=Object(r.useRef)(null),i=function r(i){if(null!=t.current){var o=i-t.current;e(o/1e3)}t.current=i,n.current=requestAnimationFrame(r)};Object(r.useEffect)((function(){return n.current=requestAnimationFrame(i),function(){return cancelAnimationFrame(n.current)}}),[])},o=t(161);function a(){var e=Object(r.useState)((function(){return new o.a}))[0];return Object(r.useEffect)((function(){"undefined"!=typeof window&&(window.ecs=e)})),e}var c=t(165),s=t(162);function u(e){var n=Object(s.b)(),t=Object(r.useState)(new e),i=t[0],o=t[1];return Object(r.useEffect)((function(){var t=n.get(e);t?o(t):console.error("Couldn't find facet on entity: "+e.prototype.constructor.name)})),i}var l=t(167),d=t(178),f=t(160),h=function(){function e(e){Object(f.a)(this,"ref",void 0),this.ref=e}var n=e.prototype;return n.loop=function(e,n){if(this.current)return this.current.loop(e,n)},n.countBy=function(e){return this.current?this.current.countBy(e):0},n.filter=function(e){return this.current?this.current.filter(e):[]},n.has=function(e){return!!this.current&&this.current.has(e)},n.clear=function(){if(this.current)return this.current.clear()},Object(d.a)(e,[{key:"current",get:function(){return this.ref.current}},{key:"entities",get:function(){if(this.current)return this.current.entities}},{key:"first",get:function(){if(this.current)return this.current.first}},{key:"last",get:function(){if(this.current)return this.current.last}},{key:"length",get:function(){if(this.current)return this.current.length}},{key:"isEmpty",get:function(){return!this.current||this.current.isEmpty}}]),e}();function m(e,n){var t=Object(c.a)(),i=Object(r.useRef)(),o=Object(r.useState)(0),a=o[0],s=o[1],u=function(){return s(a+1)};return Object(r.useEffect)((function(){if(void 0===i.current){var r=new l.a(e);null!=n&&n.added&&r.onEntityAdded.connect(n.added),null!=n&&n.removed&&r.onEntityRemoved.connect(n.removed),r.onEntityAdded.connect(u),r.onEntityRemoved.connect(u),t.addQuery(r),i.current=r,u()}}),[]),new h(i)}t(168);var p=t(169);t(170)},174:function(e,n,t){"use strict";t(167);var r=t(175);t.o(r,"rad")&&t.d(n,"rad",(function(){return r.rad}));t(166);var i=t(176);t.d(n,"rad",(function(){return i.a}))},175:function(e,n){},176:function(e,n,t){"use strict";function r(e){return e*Math.PI/180}t.d(n,"a",(function(){return r}))},177:function(e,n,t){"use strict";t.d(n,"a",(function(){return l})),t.d(n,"b",(function(){return d.b})),t.d(n,"c",(function(){return b})),t.d(n,"d",(function(){return y})),t.d(n,"e",(function(){return O}));var r=t(178),i=t(164),o=t(4),a=t(160),c=t(0),s=t.n(c),u=t(171),l=function(e){function n(n){var t;return t=e.call(this,n)||this,Object(a.a)(Object(i.a)(t),"context",void 0),Object(a.a)(Object(i.a)(t),"ref",void 0),t.ref=Object(c.createRef)(),t}Object(o.a)(n,e);var t=n.prototype;return t.componentDidMount=function(){this.context.add(this)},t.render=function(){if(1!==c.Children.count(this.props.children))throw new Error("<DOMView /> must have a single child.");return s.a.createElement(s.a.Fragment,null,Object(c.cloneElement)(this.props.children,{ref:this.ref}))},Object(r.a)(n,[{key:"element",get:function(){return this.ref.current}}]),n}(c.Component);Object(a.a)(l,"contextType",u.a),l.__componentClassId__=-1;var d=t(161),f=t(165),h=t(168),m=t(170),p={emissionDelay:.1},b=function(e){var n=Object(f.a)(),t=(e=Object.assign({},p,e)).emissionDelay,r=Object(c.useRef)(0),i=e.children,o=Object(h.a)([]),a=o[0],u=o[1];Object(m.a)(t,(function(){var e,n;u([(e=Object(c.createRef)(),n=r.current++,{element:i instanceof Function?Object.assign({},i(),{ref:e,key:n}):Object(c.cloneElement)(i,Object.assign({},{},{ref:e,key:n})),ref:e})].concat(a.current))}));var l=function(e){!function(e){if(e>-1)if(1===a.current.length)u([]);else{var n=a.current.slice(0,e),t=a.current.slice(e+1);u(n.concat(t))}}(a.current.findIndex((function(n){var t;return(null===(t=n.ref.current)||void 0===t?void 0:t.entity.id)===e.id})))};return Object(c.useEffect)((function(){return n.onEntityRemoved.connect(l),function(){n.onEntityRemoved.disconnect(l)}}),[]),s.a.createElement(s.a.Fragment,null,a.current.map((function(e){return e.element})))},g=t(173),v=t(162),y=function(e){function n(n){var t;return t=e.call(this,n)||this,Object(a.a)(Object(i.a)(t),"context",void 0),Object(a.a)(Object(i.a)(t),"entity",void 0),t.entity=new g.Entity,t}Object(o.a)(n,e);var t=n.prototype;return t.componentDidMount=function(){this.context.engine.addEntity(this.entity)},t.componentWillUnmount=function(){this.entity.clear(),this.entity.invalidate(),this.context.engine.removeEntity(this.entity)},t.render=function(){return s.a.createElement(v.a.Provider,{value:this.entity},this.props.children)},n}(c.Component);Object(a.a)(y,"contextType",d.b);var w=t(197);Object(w.a)({enforceActions:"never"});var j=["props","context","refs","updater","meta"],O=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return n=e.call.apply(e,[this].concat(r))||this,Object(a.a)(Object(i.a)(n),"context",void 0),n}Object(o.a)(n,e);var t=n.prototype;return t.createFake=function(){return new(0,Object.getPrototypeOf(this).constructor)},t.getAnnotations=function(e){var n=new Map(Object.getOwnPropertyNames(e).filter((function(e){return!j.includes(e)&&!e.endsWith("Ref")})).map((function(e){return[e,w.c]}))).entries();return Object.fromEntries(n)},t.asComponent=function(){return this},t.componentDidMount=function(){if(this.context){Object.assign(this,this.props);var e=this.createFake(),n=this.getAnnotations(e);Object(w.b)(this,n,{autoBind:!0}),this.context.add(this)}else console.error("Data Component without Entity Context!")},t.render=function(){return Object.assign(this,this.props),null},n}(c.Component);Object(a.a)(O,"contextType",v.a)},181:function(e,n,t){"use strict";t.d(n,"a",(function(){return l}));var r=t(178),i=t(164),o=t(4),a=t(160),c=t(163),s=t(0),u=t.n(s),l=function(e){function n(n){var t;return t=e.call(this,n)||this,Object(a.a)(Object(i.a)(t),"context",void 0),Object(a.a)(Object(i.a)(t),"ref",void 0),t.ref=Object(s.createRef)(),t}Object(o.a)(n,e);var t=n.prototype;return t.componentDidMount=function(){this.context.add(this)},t.render=function(){if(1!==s.Children.count(this.props.children))throw new Error("<ThreeView /> must have a single child.");return u.a.createElement(u.a.Fragment,null,u.a.cloneElement(this.props.children,{ref:this.ref}))},Object(r.a)(n,[{key:"object3d",get:function(){return this.ref.current}}]),n}(s.Component);Object(a.a)(l,"contextType",c.EntityContext),l.__componentClassId__=100},184:function(e,n,t){e.exports={example:"example_1hIu",leva:"leva_2JxF"}},185:function(e,n,t){"use strict";t.d(n,"a",(function(){return f}));var r=t(190),i=t(186),o=t(0),a=t.n(o),c=t(3),s=t(183),u=function(e){return a.a.createElement(s.a,Object(c.a)({},s.b,{code:e.code,language:"tsx"}),(function(e){var n=e.className,t=e.style,r=e.tokens,i=e.getLineProps,o=e.getTokenProps;return a.a.createElement("pre",{className:n,style:t},r.map((function(e,n){return a.a.createElement("div",i({line:e,key:n}),e.map((function(e,n){return a.a.createElement("span",o({token:e,key:n}))})))})))}))},l=t(184),d=t.n(l),f=function(e){return a.a.createElement("div",{style:{flex:1,display:"flex",alignItems:"stretch",flexDirection:"column"}},a.a.createElement("div",{className:d.a.leva,style:{top:"75px",display:e.hideControls?"none":"block"}},a.a.createElement(i.a,{fill:!0,collapsed:e.collapsed})),a.a.createElement("div",{className:d.a.example,style:Object.assign({marginBottom:"1em",position:"relative",overflow:"hidden",padding:"1em"},e.style||{})},a.a.createElement(r.a,{fallback:a.a.createElement("div",null)},(function(){return a.a.createElement(o.Suspense,{fallback:a.a.createElement("div",null)},e.children)}))),e.code&&a.a.createElement(u,{code:e.code}))}},187:function(e,n,t){"use strict";t.d(n,"a",(function(){return r.a})),t.d(n,"b",(function(){return i.a})),t.d(n,"c",(function(){return u})),t.d(n,"d",(function(){return h.a}));var r=t(198),i=t(191),o=t(293),a=t(0),c=t.n(a),s=t(200),u=function(e){return c.a.createElement(c.a.Fragment,null,c.a.createElement(s.a,{size:e.size}),e.showBounds&&c.a.createElement(c.a.Fragment,null,c.a.createElement(o.a,{scale:3}),c.a.createElement(o.a,{position:[e.size,e.size,e.size]}),c.a.createElement(o.a,{position:[-e.size,-e.size,-e.size]}),c.a.createElement(o.a,{position:[e.size,-e.size,e.size]}),c.a.createElement(o.a,{position:[-e.size,e.size,-e.size]}),c.a.createElement(o.a,{position:[e.size,e.size,-e.size]}),c.a.createElement(o.a,{position:[-e.size,-e.size,e.size]}),c.a.createElement(o.a,{position:[e.size,-e.size,-e.size]}),c.a.createElement(o.a,{position:[-e.size,e.size,e.size]})))},l=t(164),d=t(4),f=t(160);(function(e){function n(){for(var n,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return n=e.call.apply(e,[this].concat(r))||this,Object(f.a)(Object(l.a)(n),"targetView",void 0),Object(f.a)(Object(l.a)(n),"pointerRef",void 0),n}return Object(d.a)(n,e),n}(t(163).Facet)).__componentClassId__=99;var h=t(199)},191:function(e,n,t){"use strict";t.d(n,"a",(function(){return a}));var r=t(164),i=t(4),o=t(160),a=function(e){function n(){for(var n,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return n=e.call.apply(e,[this].concat(i))||this,Object(o.a)(Object(r.a)(n),"meta",{neighbors:[]}),n}return Object(i.a)(n,e),n}(t(163).Facet)},198:function(e,n,t){"use strict";t.d(n,"a",(function(){return s}));var r=t(164),i=t(4),o=t(160),a=t(163),c=t(180),s=function(e){function n(){for(var n,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return n=e.call.apply(e,[this].concat(i))||this,Object(o.a)(Object(r.a)(n),"amount",new c.Vector3(0,0,0)),n}return Object(i.a)(n,e),n}(a.Facet)},199:function(e,n,t){"use strict";t.d(n,"a",(function(){return s}));var r=t(164),i=t(4),o=t(160),a=t(163),c=t(180),s=function(e){function n(){for(var n,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return n=e.call.apply(e,[this].concat(i))||this,Object(o.a)(Object(r.a)(n),"amount",new c.Vector3(Math.random()-.5,Math.random()-.5,Math.random()-.5)),n}return Object(i.a)(n,e),n}(a.Facet)},200:function(e,n,t){"use strict";t.d(n,"a",(function(){return a}));var r=t(163),i=t(181),o=t(202),a=function(e){var n=Object(r.useQuery)((function(e){return e.hasAll(i.a,o.a)}));return Object(r.useSystem)((function(t){n.loop([i.a],(function(n,t){var r=t[0].object3d.position;r.x<-e.size?r.setX(e.size):r.x>e.size&&r.setX(-e.size),r.y<-e.size?r.setY(e.size):r.y>e.size&&r.setY(-e.size),r.z<-e.size?r.setZ(e.size):r.z>e.size&&r.setZ(-e.size)}))}))}},202:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var r=t(4),i=function(e){function n(){return e.apply(this,arguments)||this}return Object(r.a)(n,e),n}(t(163).Facet)}}]);