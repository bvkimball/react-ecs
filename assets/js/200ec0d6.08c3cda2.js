(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{152:function(t,e,n){"use strict";n.r(e),n.d(e,"frontMatter",(function(){return j})),n.d(e,"metadata",(function(){return E})),n.d(e,"toc",(function(){return g})),n.d(e,"default",(function(){return x}));var r=n(3),c=n(7),o=n(0),u=n.n(o),i=n(159),a=n(186),s=n(164),l=n(4),f=n(160),d=n(162),m=n(227),b=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return e=t.call.apply(t,[this].concat(r))||this,Object(f.a)(Object(s.a)(e),"value",0),Object(f.a)(Object(s.a)(e),"step",1),e}return Object(l.a)(e,t),e}(d.Facet),p=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return e=t.call.apply(t,[this].concat(r))||this,Object(f.a)(Object(s.a)(e),"r",255),Object(f.a)(Object(s.a)(e),"g",255),Object(f.a)(Object(s.a)(e),"b",255),e}return Object(l.a)(e,t),e}(d.Facet),h=function(){var t=Object(d.useQuery)((function(t){return t.hasAll(b)}));return Object(d.useSystem)((function(e){t.loop([b],(function(t,e){e[0].value-=1}))}))},y=function(){var t=Object(d.useQuery)((function(t){return t.has(p)}));return Object(d.useSystem)((function(e){t.loop([p],(function(t,e){var n=e[0];n.r=Math.floor(255*Math.random()),n.g=Math.floor(255*Math.random()),n.b=Math.floor(255*Math.random())}))}))},v=Object(m.a)((function(){var t=Object(d.useFacet)(b),e=Object(d.useFacet)(p),n="rgb("+e.r+", "+e.g+", "+e.b+")";return u.a.createElement("h1",{style:{color:n}},"Counter: ",t.value)})),O=function(t){var e=Object(d.useECS)();return Object(d.useAnimationFrame)(e.update),u.a.createElement(e.Provider,null,u.a.createElement(h,null),u.a.createElement(y,null),u.a.createElement(d.Entity,null,u.a.createElement(b,null),u.a.createElement(p,null),u.a.createElement(v,null)))},j={sidebar_position:2,sidebar_label:"Multiple Systems",title:"Multiple Systems"},E={unversionedId:"core/MultipleSystems",id:"core/MultipleSystems",isDocsHomePage:!1,title:"Multiple Systems",description:"",source:"@site/examples/core/MultipleSystems.md",sourceDirName:"core",slug:"/core/MultipleSystems",permalink:"/examples/core/MultipleSystems",version:"current",sidebar_label:"Multiple Systems",sidebarPosition:2,frontMatter:{sidebar_position:2,sidebar_label:"Multiple Systems",title:"Multiple Systems"},sidebar:"mySidebar",previous:{title:"Facet Observer",permalink:"/examples/core/FacetObserver"},next:{title:"Multiple Queries",permalink:"/examples/core/MultipleQueries"}},g=[],C={toc:g};function x(t){var e=t.components,n=Object(c.a)(t,["components"]);return Object(i.b)("wrapper",Object(r.a)({},C,n,{components:e,mdxType:"MDXLayout"}),Object(i.b)(a.a,{code:"import {\n    Entity,\n    Facet,\n    useAnimationFrame,\n    useECS,\n    useFacet,\n    useQuery,\n    useSystem\n} from '@react-ecs/core';\nimport { observer } from 'mobx-react';\nimport React, { FC } from 'react';\n\nclass Counter extends Facet<Counter> {\n    value?: number = 0;\n    step?: number = 1;\n}\n\nclass Color extends Facet<Color> {\n    r?: number = 255;\n    g?: number = 255;\n    b?: number = 255;\n}\n\nconst CounterSystem = () => {\n    const query = useQuery(e => e.hasAll(Counter));\n\n    return useSystem((dt: number) => {\n        query.loop([Counter], (_, [counter]) => {\n            counter.value -= 1;\n        });\n    });\n};\n\nconst RandomColorSystem = () => {\n    const query = useQuery(e => e.has(Color));\n\n    return useSystem((dt: number) => {\n        query.loop([Color], (_, [color]) => {\n            color.r = Math.floor(Math.random() * 255);\n            color.g = Math.floor(Math.random() * 255);\n            color.b = Math.floor(Math.random() * 255);\n        });\n    });\n};\n\nconst CounterDisplay = observer(() => {\n    const counter = useFacet(Counter);\n    const rgb = useFacet(Color);\n    const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;\n    return <h1 style={{ color }}>Counter: {counter.value}</h1>;\n});\n\nexport const MultipleSystems: FC = props => {\n    const ECS = useECS();\n\n    useAnimationFrame(ECS.update);\n\n    return (\n        <ECS.Provider>\n            <CounterSystem />\n            <RandomColorSystem />\n\n            <Entity>\n                <Counter />\n                <Color />\n\n                <CounterDisplay />\n            </Entity>\n        </ECS.Provider>\n    );\n};\n",style:{minHeight:"auto",padding:"1em"},mdxType:"Example"},Object(i.b)(O,{mdxType:"MultipleSystems"})))}x.isMDXComponent=!0},161:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return s}));var r=n(160),c=n(0),o=n.n(c),u=n(173),i=n(166),a=Object(c.createContext)(null),s=function(){function t(t,e){var n=this;void 0===t&&(t=[]),void 0===e&&(e=[]),Object(r.a)(this,"engine",new u.Engine),Object(r.a)(this,"systems",new i.a),this.update=this.update.bind(this),this.Provider=this.Provider.bind(this),t.forEach((function(t){return n.systems.add(t)})),e.forEach((function(t){return n.engine.addEntity(t)}))}var e=t.prototype;return e.update=function(t){this.systems.update(t)},e.Provider=function(t){return o.a.createElement(a.Provider,{value:this},t.children)},t}()},162:function(t,e,n){"use strict";var r=n(177);n.d(e,"DOMView",(function(){return r.a})),n.d(e,"ECSContext",(function(){return r.b})),n.d(e,"Emitter",(function(){return r.c})),n.d(e,"Entity",(function(){return r.d})),n.d(e,"Facet",(function(){return r.e}));var c=n(171);n.d(e,"EntityContext",(function(){return c.a})),n.d(e,"useAnimationFrame",(function(){return c.b})),n.d(e,"useECS",(function(){return c.c})),n.d(e,"useEngine",(function(){return c.d})),n.d(e,"useFacet",(function(){return c.e})),n.d(e,"useQuery",(function(){return c.f})),n.d(e,"useSystem",(function(){return c.g}));var o=n(174);n.o(o,"rad")&&n.d(e,"rad",(function(){return o.rad}))},163:function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return o}));var r=n(0),c=Object(r.createContext)(null);function o(){var t=Object(r.useContext)(c);if(!t)throw new Error("Missing Entity instance in EntityContext!");return t}},165:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(0),c=n(161),o=function(){return Object(r.useContext)(c.b).engine}},166:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(160),c=function(){function t(){Object(r.a)(this,"systems",void 0),this.systems=new Array}var e=t.prototype;return e.sort=function(){this.systems.sort((function(t,e){return t.priority-e.priority}))},e.add=function(t,e){void 0===e&&(e=0),this.systems.push({callback:t,priority:e}),this.sort()},e.remove=function(t){var e=this.systems.findIndex((function(e){return e.callback===t}));return e>-1&&(this.systems.splice(e,1),this.sort(),!0)},e.clear=function(){this.systems=[]},e.update=function(t){this.systems.forEach((function(e){return e.callback(t)}))},t}()},167:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n(181),c=n(4),o=n(173),u=function(t){function e(){return t.apply(this,arguments)||this}Object(c.a)(e,t);var n=e.prototype;return n.loop=function(t,e){for(var n=0;n<this.entities.length;n++){for(var c,o=this.entities[n],u=[],i=Object(r.a)(t);!(c=i()).done;){var a=c.value,s=o.get(a);u.push(s)}e(o,u,n)}},n.rloop=function(t,e){for(var n=this.entities.length-1;n>=0;n--){for(var c,o=this.entities[n],u=[],i=Object(r.a)(t);!(c=i()).done;){var a=c.value,s=o.get(a);u.push(s)}e(o,u,n)}},e}(o.Query)},168:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(0);function c(t){var e=Object(r.useRef)(t),n=Object(r.useState)({current:t}),c=(n[0],n[1]);return[e,function(t){e.current=t,c({current:t})}]}},169:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(0),c=n(161),o=function(t,e){void 0===e&&(e=0);var n=Object(r.useContext)(c.b).systems;return Object(r.useEffect)((function(){return n.add(t,e),function(){n.remove(t)}}),[t,e]),null}},170:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(0),c=n(169),o=function(t,e){var n=Object(r.useRef)(0);Object(c.a)((function(r){n.current+=r,n.current>t&&(n.current=0,e())}))}},171:function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"c",(function(){return u})),n.d(e,"d",(function(){return i.a})),n.d(e,"a",(function(){return a.a})),n.d(e,"e",(function(){return s})),n.d(e,"f",(function(){return b})),n.d(e,"g",(function(){return p.a}));var r=n(0),c=function(t){var e=Object(r.useRef)(null),n=Object(r.useRef)(null),c=function r(c){if(null!=n.current){var o=c-n.current;t(o/1e3)}n.current=c,e.current=requestAnimationFrame(r)};Object(r.useEffect)((function(){return e.current=requestAnimationFrame(c),function(){return cancelAnimationFrame(e.current)}}),[])},o=n(161);function u(){var t=Object(r.useState)((function(){return new o.a}))[0];return Object(r.useEffect)((function(){"undefined"!=typeof window&&(window.ecs=t)})),t}var i=n(165),a=n(163);function s(t){var e=Object(a.b)(),n=Object(r.useState)(new t),c=n[0],o=n[1];return Object(r.useEffect)((function(){var n=e.get(t);n?o(n):console.error("Couldn't find facet on entity: "+t.prototype.constructor.name)})),c}var l=n(167),f=n(180),d=n(160),m=function(){function t(t){Object(d.a)(this,"ref",void 0),this.ref=t}var e=t.prototype;return e.loop=function(t,e){if(this.current)return this.current.loop(t,e)},e.rloop=function(t,e){if(this.current)return this.current.rloop(t,e)},e.countBy=function(t){return this.current?this.current.countBy(t):0},e.filter=function(t){return this.current?this.current.filter(t):[]},e.has=function(t){return!!this.current&&this.current.has(t)},e.clear=function(){if(this.current)return this.current.clear()},Object(f.a)(t,[{key:"current",get:function(){return this.ref.current}},{key:"entities",get:function(){if(this.current)return this.current.entities}},{key:"first",get:function(){if(this.current)return this.current.first}},{key:"last",get:function(){if(this.current)return this.current.last}},{key:"length",get:function(){if(this.current)return this.current.length}},{key:"isEmpty",get:function(){return!this.current||this.current.isEmpty}}]),t}();function b(t,e){var n=Object(i.a)(),c=Object(r.useRef)(),o=Object(r.useState)(0),u=o[0],a=o[1],s=function(){return a(u+1)};return Object(r.useEffect)((function(){if(void 0===c.current){var r=new l.a(t);null!=e&&e.added&&r.onEntityAdded.connect(e.added),null!=e&&e.removed&&r.onEntityRemoved.connect(e.removed),r.onEntityAdded.connect(s),r.onEntityRemoved.connect(s),n.addQuery(r),c.current=r,s()}}),[]),new m(c)}n(168);var p=n(169);n(170)},174:function(t,e,n){"use strict";n(167);var r=n(175);n.o(r,"rad")&&n.d(e,"rad",(function(){return r.rad}));n(166);var c=n(176);n.d(e,"rad",(function(){return c.a}))},175:function(t,e){},176:function(t,e,n){"use strict";function r(t){return t*Math.PI/180}n.d(e,"a",(function(){return r}))},177:function(t,e,n){"use strict";n.d(e,"a",(function(){return l})),n.d(e,"b",(function(){return f.b})),n.d(e,"c",(function(){return h})),n.d(e,"d",(function(){return O})),n.d(e,"e",(function(){return g}));var r=n(180),c=n(164),o=n(4),u=n(160),i=n(0),a=n.n(i),s=n(171),l=function(t){function e(e){var n;return n=t.call(this,e)||this,Object(u.a)(Object(c.a)(n),"context",void 0),Object(u.a)(Object(c.a)(n),"ref",void 0),n.ref=Object(i.createRef)(),n}Object(o.a)(e,t);var n=e.prototype;return n.componentDidMount=function(){this.context.add(this)},n.render=function(){if(1!==i.Children.count(this.props.children))throw new Error("<DOMView /> must have a single child.");return a.a.createElement(a.a.Fragment,null,Object(i.cloneElement)(this.props.children,{ref:this.ref}))},Object(r.a)(e,[{key:"element",get:function(){return this.ref.current}}]),e}(i.Component);Object(u.a)(l,"contextType",s.a),l.__componentClassId__=-1;var f=n(161),d=n(165),m=n(168),b=n(170),p={emissionDelay:.1},h=function(t){var e=Object(d.a)(),n=(t=Object.assign({},p,t)).emissionDelay,r=Object(i.useRef)(0),c=t.children,o=Object(m.a)([]),u=o[0],s=o[1];Object(b.a)(n,(function(){var t,e;s([(t=Object(i.createRef)(),e=r.current++,{element:c instanceof Function?Object.assign({},c(),{ref:t,key:e}):Object(i.cloneElement)(c,Object.assign({},{},{ref:t,key:e})),ref:t})].concat(u.current))}));var l=function(t){!function(t){if(t>-1)if(1===u.current.length)s([]);else{var e=u.current.slice(0,t),n=u.current.slice(t+1);s(e.concat(n))}}(u.current.findIndex((function(e){var n;return(null===(n=e.ref.current)||void 0===n?void 0:n.entity.id)===t.id})))};return Object(i.useEffect)((function(){return e.onEntityRemoved.connect(l),function(){e.onEntityRemoved.disconnect(l)}}),[]),a.a.createElement(a.a.Fragment,null,u.current.map((function(t){return t.element})))},y=n(173),v=n(163),O=function(t){function e(e){var n;return n=t.call(this,e)||this,Object(u.a)(Object(c.a)(n),"context",void 0),Object(u.a)(Object(c.a)(n),"entity",void 0),n.entity=new y.Entity,n}Object(o.a)(e,t);var n=e.prototype;return n.componentDidMount=function(){this.context.engine.addEntity(this.entity)},n.componentWillUnmount=function(){this.entity.clear(),this.entity.invalidate(),this.context.engine.removeEntity(this.entity)},n.render=function(){return a.a.createElement(v.a.Provider,{value:this.entity},this.props.children)},e}(i.Component);Object(u.a)(O,"contextType",f.b);var j=n(194);Object(j.a)({enforceActions:"never"});var E=["props","context","refs","updater","meta"],g=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,Object(u.a)(Object(c.a)(e),"context",void 0),e}Object(o.a)(e,t);var n=e.prototype;return n.createFake=function(){return new(0,Object.getPrototypeOf(this).constructor)},n.getAnnotations=function(t){var e=new Map(Object.getOwnPropertyNames(t).filter((function(t){return!E.includes(t)&&!t.endsWith("Ref")})).map((function(t){return[t,j.c]}))).entries();return Object.fromEntries(e)},n.asComponent=function(){return this},n.componentDidMount=function(){if(this.context){Object.assign(this,this.props);var t=this.createFake(),e=this.getAnnotations(t);Object(j.b)(this,e,{autoBind:!0}),this.context.add(this)}else console.error("Data Component without Entity Context!")},n.render=function(){return Object.assign(this,this.props),null},e}(i.Component);Object(u.a)(g,"contextType",v.a)},184:function(t,e,n){t.exports={example:"example_1hIu",leva:"leva_2JxF"}},186:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var r=n(189),c=n(185),o=n(0),u=n.n(o),i=n(3),a=n(183),s=function(t){return u.a.createElement(a.a,Object(i.a)({},a.b,{code:t.code,language:"tsx"}),(function(t){var e=t.className,n=t.style,r=t.tokens,c=t.getLineProps,o=t.getTokenProps;return u.a.createElement("pre",{className:e,style:n},r.map((function(t,e){return u.a.createElement("div",c({line:t,key:e}),t.map((function(t,e){return u.a.createElement("span",o({token:t,key:e}))})))})))}))},l=n(184),f=n.n(l),d=function(t){return u.a.createElement("div",{style:{flex:1,display:"flex",alignItems:"stretch",flexDirection:"column"}},u.a.createElement("div",{className:f.a.leva,style:{top:"75px",display:t.hideControls?"none":"block"}},u.a.createElement(c.a,{fill:!0,collapsed:t.collapsed})),u.a.createElement("div",{className:f.a.example,style:Object.assign({marginBottom:"1em",position:"relative",overflow:"hidden",padding:"1em"},t.style||{})},u.a.createElement(r.a,{fallback:u.a.createElement("div",null)},(function(){return u.a.createElement(o.Suspense,{fallback:u.a.createElement("div",null)},t.children)}))),t.code&&u.a.createElement(s,{code:t.code}))}}}]);