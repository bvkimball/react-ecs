(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{136:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return u})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return b})),n.d(t,"default",(function(){return p}));var r=n(3),a=n(7),i=(n(0),n(158)),o=n(188),c=(n(209),n(201)),s=n(185),u=(n(184),{slug:"hello-world",title:"Hello, world.",author:"Dustin Lacewell",author_title:"React-ECS Team",author_url:"https://github.com/dustinlacewell",author_image_url:"https://avatars.githubusercontent.com/u/53952?v=4",tags:["release"]}),l={permalink:"/blog/hello-world",editUrl:"https://github.com/dustinlacewell/react-ecs/edit/master/apps/docs/blog/2021-04-24-hello-world.md",source:"@site/blog/2021-04-24-hello-world.md",title:"Hello, world.",description:"I am happy to release the first public alpha of React ECS, version 0.0.3.",date:"2021-04-24T00:00:00.000Z",formattedDate:"April 23, 2021",tags:[{label:"release",permalink:"/blog/tags/release"}],readingTime:4.925,truncated:!1,nextItem:{title:"Coming Soon",permalink:"/blog/coming-soon"}},b=[{value:"Conception",id:"conception",children:[{value:"Picking an ECS",id:"picking-an-ecs",children:[]}]},{value:"Technical Articles",id:"technical-articles",children:[]},{value:"Packages",id:"packages",children:[]},{value:"Documentation",id:"documentation",children:[]},{value:"Alpha Issues",id:"alpha-issues",children:[]},{value:"Community",id:"community",children:[]},{value:"Contribute",id:"contribute",children:[]},{value:"Conclusion",id:"conclusion",children:[]}],f={toc:b};function p(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},f,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"I am happy to release the first public alpha of React ECS, version ",Object(i.b)("inlineCode",{parentName:"p"},"0.0.3"),"."),Object(i.b)("p",null,"React ECS allows you to use the ECS (or ",Object(i.b)("a",{parentName:"p",href:"/docs/#whats-that"},"entity component system"),") pattern in a natural way with ",Object(i.b)("a",{parentName:"p",href:"https://reactjs.org/"},"React"),"."),Object(i.b)(o.a,{fallback:Object(i.b)("div",null),mdxType:"BrowserOnly"},(function(){return Object(i.b)("iframe",{src:"https://codesandbox.io/embed/react-ecs-demo-tv5xj?fontsize=14&hidenavigation=1&theme=dark&verticallayout=1",style:{width:"100%",height:"500px",border:0,borderRadius:"4px",overflow:"hidden"},title:"React ECS Demo",allow:"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking",sandbox:"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"})})),Object(i.b)("h2",{id:"conception"},"Conception"),Object(i.b)("p",null,"React ECS was created because a little more than a month ago, I had this idea for a 3D, neural-network version of a 2D genetic algorithm creature evolver I had built when I was a kid."),Object(i.b)("p",null,"I knew I wanted to build it for the web so that it could be easily shared and my first intuition was to use Unity. However, an acquaintance who was interested in collaborating didn't know it."),Object(i.b)("p",null,"I found ",Object(i.b)("a",{parentName:"p",href:"https://threejs.org"},"ThreeJS")," and ",Object(i.b)("a",{parentName:"p",href:"https://www.babylonjs.com/"},"BabylonJS")," pretty quickly and built small prototypes with each. But what I didn't like was trying to mix the imperative code I was writing to interact with their APIs, and the declarative React code I was writing for the web bits around it. I basically always reach for React these days, even for small experiments. Maybe I could make the 3D bits declarative too?"),Object(i.b)("p",null,'When I searched for "react threejs" I instantly found ',Object(i.b)("a",{parentName:"p",href:"https://github.com/pmndrs/react-three-fiber"},"@react-three/fiber")," which is a mind-blowingly excellent library. Essentially, it just has React components that correspond to all the ThreeJS bits, and there you go. Declarative ThreeJS scenes using React."),Object(i.b)("p",null,"For BabylonJS a similar library exists, ",Object(i.b)("a",{parentName:"p",href:"https://github.com/brianzinn/react-babylonjs"},"react-babylonjs"),". So cool. I ultimately went with ",Object(i.b)("inlineCode",{parentName:"p"},"react-three/fiber"),"."),Object(i.b)("h3",{id:"picking-an-ecs"},"Picking an ECS"),Object(i.b)("p",null,"When it came to the behavior of the simulation my thoughts drifted to ECS, as it's now a dominating pattern in both Unity and Unreal. As I looked through the ECS / Typescript landscape I found ",Object(i.b)("strong",{parentName:"p"},"many")," excellent projects; ",Object(i.b)("a",{parentName:"p",href:"https://github.com/ecsyjs/ecsy"},"escy"),", ",Object(i.b)("a",{parentName:"p",href:"https://github.com/NateTheGreatt/bitecs"},"bitecs"),", ",Object(i.b)("a",{parentName:"p",href:"https://github.com/grebaldi/nopun-ecs"},"nopun")," and more."),Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"https://github.com/mayakwd/tick-knock"},"tick-knock")," is what React ECS uses under the hood. Like its project description says:"),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Small and powerful, type-safe and easy-to-use Entity-Component-System (ECS) library written in TypeScript")),Object(i.b)("p",null,"It's the type-safe bit that really sold me. In particular, it allowed a rich API for React ECS' query interface:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-tsx"},"// create query that tracks entities with Enemy, Health and PoisonStatus facets\nconst query = useQuery((entity) => entity.hasAll(Enemy, Health, PoisonStatus));\n")),Object(i.b)("p",null,"OK, that's not very impressive. But when it comes time to use the query, the type-safety really shines:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-tsx"},"const query = useQuery((entity) => entity.hasAll(Enemy, Health, PoisonStatus));\n\nquery.loop([PoisonStatus, Health], (entity, [poison, health]) => {\n    // ...\n});\n")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"Query.loop")," allows you to pass a tuple (not array) of distinct facet types in the first arg, which determines the types in the tuple (not array) your callback receives."),Object(i.b)("p",null,'I stress "not array", because your editor will unambiguously know that ',Object(i.b)("inlineCode",{parentName:"p"},"poison")," is of type ",Object(i.b)("inlineCode",{parentName:"p"},"PoisonStatus")," and ",Object(i.b)("inlineCode",{parentName:"p"},"health")," of type ",Object(i.b)("inlineCode",{parentName:"p"},"Health"),". This was ",Object(i.b)("em",{parentName:"p"},"no small feat"),", and this kind of API is only made possible by TypeScript's incredible ",Object(i.b)("a",{parentName:"p",href:"https://www.typescriptlang.org/docs/handbook/2/mapped-types.html"},"mapped types")," feature."),Object(i.b)("p",null,"React ECS may move onto its own ECS implementation one day (or fork tick-knock), but for now it works quite well."),Object(i.b)("h2",{id:"technical-articles"},"Technical Articles"),Object(i.b)("p",null,"There are some pretty challenging puzzles that needed solving in order to get the React ECS API we have today."),Object(i.b)("p",null,"I will be publishing some articles on some of the more interesting ones in the future."),Object(i.b)("h2",{id:"packages"},"Packages"),Object(i.b)("p",null,"We actually have multiple packages:"),Object(i.b)("table",null,Object(i.b)("tbody",null,Object(i.b)("tr",null,Object(i.b)("td",null,Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"/docs/core"},"@react-ecs/core"))),Object(i.b)("td",null,Object(i.b)("p",null,"Our primary package, containing all the hooks and components needed to use ECS with React."))),Object(i.b)("tr",null,Object(i.b)("td",null,Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"/docs/three"},"@react-ecs/three"))),Object(i.b)("td",null,Object(i.b)("p",null,"Our ",Object(i.b)("a",{parentName:"p",href:"/docs/core/entity_views"},"View Integration")," for ",Object(i.b)("a",{parentName:"p",href:"https://threejs.org/"},"ThreeJS")))),Object(i.b)("tr",null,Object(i.b)("td",null,Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"https://github.com/dustinlacewell/react-ecs/tree/master/libs/boids/"},"@react-ecs/boids"))),Object(i.b)("td",null,Object(i.b)("p",null,"Ready to go bits for a ",Object(i.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Boids"},"boids simulation")))))),Object(i.b)("p",null,"The plan is to continue to grow this ecosystem with additional libraries. We've already had some experimental success with ",Object(i.b)("a",{parentName:"p",href:"https://www.babylonjs.com/"},"BabylonJS")," and ",Object(i.b)("a",{parentName:"p",href:"https://github.com/pmndrs/cannon-es"},"CannonJS")," integrations."),Object(i.b)("h2",{id:"documentation"},"Documentation"),Object(i.b)("p",null,"Documentation for the current version is ready to go! We're eager to hear your constructive feedback."),Object(i.b)("p",null,"A User Guide and other tutorial content is currently planned, so make sure to look out for another announcement around that."),Object(i.b)("h2",{id:"alpha-issues"},"Alpha Issues"),Object(i.b)("p",null,"While best efforts were made, there's just ",Object(i.b)("em",{parentName:"p"},"no way")," this release doesn't contain a non-zero amount of the following:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"ECS bugs"),Object(i.b)("li",{parentName:"ul"},"React bugs"),Object(i.b)("li",{parentName:"ul"},"Design and API issues"),Object(i.b)("li",{parentName:"ul"},"Performance issues")),Object(i.b)("p",null,"Please file any problems, questions or suggestions you have with our ",Object(i.b)("a",{parentName:"p",href:"https://github.com/dustinlacewell/react-ecs/issues"},"issue tracker"),"."),Object(i.b)("h2",{id:"community"},"Community"),Object(i.b)("p",null,"React ECS has a channel over on the ",Object(i.b)("a",{parentName:"p",href:"https://discord.gg/RJqjqAnmJ8"},"Web ECS Discord"),"."),Object(i.b)("p",null,"Feel free to join and discuss the future of the project or get help using it."),Object(i.b)("h2",{id:"contribute"},"Contribute"),Object(i.b)("p",null,"Speaking of the future of the project; if you're interested, here's a number of areas to contribute to:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Cool examples to feature on the site"),Object(i.b)("li",{parentName:"ul"},"Additional documentation, guides and tutorial material"),Object(i.b)("li",{parentName:"ul"},"Implementing additional integrations (babylon, cannon, etc.)"),Object(i.b)("li",{parentName:"ul"},"Improving the monorepo and release automation"),Object(i.b)("li",{parentName:"ul"},"Establishing a test suite"),Object(i.b)("li",{parentName:"ul"},"Profiling and optimizing performance"),Object(i.b)("li",{parentName:"ul"},"Ensuring good interoperability with the nuances of React's own behavior"),Object(i.b)("li",{parentName:"ul"},"Help develop a story around serialization given React ECS' statically-typed focus")),Object(i.b)("p",null,"Stuff for those at every level :D"),Object(i.b)("h2",{id:"conclusion"},"Conclusion"),Object(i.b)("p",null,'Here\'s an "understatement":'),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"This was harder than I thought")),Object(i.b)("p",null,"It makes me swirl thinking back at the many abysses I've traversed getting here. Dazed. Confused. In a hopeless abandon of confounding bewilderment. The constraints of ",Object(i.b)("a",{parentName:"p",href:"https://reactnative.dev/docs/fast-refresh"},"Fast Refresh")," subverting my every expectation. The complexity of JS monorepo tooling slowly consuming me.. The limitations of NPM's republishing rules staying my struggling hands..."),Object(i.b)("p",null,"Despite it all, perseverance prevails!"),Object(i.b)("p",null,"All for you dear reader. So that we could join hands, and merrily go forth making sick web visualizations and stuff. :P"),Object(i.b)("p",null,"Join me on ",Object(i.b)("a",{parentName:"p",href:"https://discord.gg/RJqjqAnmJ8"},"Discord"),"."),Object(i.b)(s.a,{hideControls:!0,mdxType:"Example"},Object(i.b)("div",{style:{minHeight:"400px",display:"flex",alignItems:"stretch",flexDirection:"column"}},Object(i.b)(c.a,{mdxType:"DOMParticles"}))))}p.isMDXComponent=!0},158:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return d}));var r=n(0),a=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=a.a.createContext({}),l=function(e){var t=a.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},b=function(e){var t=l(e.components);return a.a.createElement(u.Provider,{value:t},e.children)},f={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},p=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),b=l(n),p=r,d=b["".concat(o,".").concat(p)]||b[p]||f[p]||i;return n?a.a.createElement(d,c(c({ref:t},u),{},{components:n})):a.a.createElement(d,c({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=p;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,o[1]=c;for(var u=2;u<i;u++)o[u]=n[u];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},160:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return u}));var r=n(159),a=n(0),i=n.n(a),o=n(172),c=n(165),s=Object(a.createContext)(null),u=function(){function e(e,t){var n=this;void 0===e&&(e=[]),void 0===t&&(t=[]),Object(r.a)(this,"engine",new o.Engine),Object(r.a)(this,"systems",new c.a),this.update=this.update.bind(this),this.Provider=this.Provider.bind(this),e.forEach((function(e){return n.systems.add(e)})),t.forEach((function(e){return n.engine.addEntity(e)}))}var t=e.prototype;return t.update=function(e){this.systems.update(e)},t.Provider=function(e){return i.a.createElement(s.Provider,{value:this},e.children)},e}()},161:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var r=n(0),a=Object(r.createContext)(null);function i(){var e=Object(r.useContext)(a);if(!e)throw new Error("Missing Entity instance in EntityContext!");return e}},163:function(e,t,n){"use strict";var r=n(176);n.d(t,"DOMView",(function(){return r.a})),n.d(t,"ECSContext",(function(){return r.b})),n.d(t,"Emitter",(function(){return r.c})),n.d(t,"Entity",(function(){return r.d})),n.d(t,"Facet",(function(){return r.e}));var a=n(170);n.d(t,"EntityContext",(function(){return a.a})),n.d(t,"useAnimationFrame",(function(){return a.b})),n.d(t,"useECS",(function(){return a.c})),n.d(t,"useEngine",(function(){return a.d})),n.d(t,"useFacet",(function(){return a.e})),n.d(t,"useQuery",(function(){return a.f})),n.d(t,"useSystem",(function(){return a.g}));var i=n(173);n.o(i,"rad")&&n.d(t,"rad",(function(){return i.rad}))},164:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),a=n(160),i=function(){return Object(r.useContext)(a.b).engine}},165:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(159),a=function(){function e(){Object(r.a)(this,"systems",void 0),this.systems=new Array}var t=e.prototype;return t.sort=function(){this.systems.sort((function(e,t){return e.priority-t.priority}))},t.add=function(e,t){void 0===t&&(t=0),this.systems.push({callback:e,priority:t}),this.sort()},t.remove=function(e){var t=this.systems.findIndex((function(t){return t.callback===e}));return t>-1&&(this.systems.splice(t,1),this.sort(),!0)},t.clear=function(){this.systems=[]},t.update=function(e){this.systems.forEach((function(t){return t.callback(e)}))},e}()},166:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(180),a=n(4),i=n(172),o=function(e){function t(){return e.apply(this,arguments)||this}return Object(a.a)(t,e),t.prototype.loop=function(e,t){for(var n,a=Object(r.a)(this.entities);!(n=a()).done;){for(var i,o=n.value,c=[],s=Object(r.a)(e);!(i=s()).done;){var u=i.value,l=o.get(u);c.push(l)}t(o,c)}},t}(i.Query)},167:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0);function a(e){var t=Object(r.useRef)(e),n=Object(r.useState)({current:e}),a=(n[0],n[1]);return[t,function(e){t.current=e,a({current:e})}]}},168:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),a=n(160),i=function(e,t){void 0===t&&(t=0);var n=Object(r.useContext)(a.b).systems;return Object(r.useEffect)((function(){return n.add(e,t),function(){n.remove(e)}}),[e,t]),null}},169:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),a=n(168),i=function(e,t){var n=Object(r.useRef)(0);Object(a.a)((function(r){n.current+=r,n.current>e&&(n.current=0,t())}))}},170:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return c.a})),n.d(t,"a",(function(){return s.a})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return d})),n.d(t,"g",(function(){return m.a}));var r=n(0),a=function(e){var t=Object(r.useRef)(null),n=Object(r.useRef)(null),a=function r(a){if(null!=n.current){var i=a-n.current;e(i/1e3)}n.current=a,t.current=requestAnimationFrame(r)};Object(r.useEffect)((function(){return t.current=requestAnimationFrame(a),function(){return cancelAnimationFrame(t.current)}}),[])},i=n(160);function o(){var e=Object(r.useState)((function(){return new i.a}))[0];return Object(r.useEffect)((function(){"undefined"!=typeof window&&(window.ecs=e)})),e}var c=n(164),s=n(161);function u(e){var t=Object(s.b)(),n=Object(r.useState)(new e),a=n[0],i=n[1];return Object(r.useEffect)((function(){var n=t.get(e);n?i(n):console.error("Couldn't find facet on entity: "+e.prototype.constructor.name)})),a}var l=n(166),b=n(178),f=n(159),p=function(){function e(e){Object(f.a)(this,"ref",void 0),this.ref=e}var t=e.prototype;return t.loop=function(e,t){if(this.current)return this.current.loop(e,t)},t.countBy=function(e){return this.current?this.current.countBy(e):0},t.filter=function(e){return this.current?this.current.filter(e):[]},t.has=function(e){return!!this.current&&this.current.has(e)},t.clear=function(){if(this.current)return this.current.clear()},Object(b.a)(e,[{key:"current",get:function(){return this.ref.current}},{key:"entities",get:function(){if(this.current)return this.current.entities}},{key:"first",get:function(){if(this.current)return this.current.first}},{key:"last",get:function(){if(this.current)return this.current.last}},{key:"length",get:function(){if(this.current)return this.current.length}},{key:"isEmpty",get:function(){return!this.current||this.current.isEmpty}}]),e}();function d(e,t){var n=Object(c.a)(),a=Object(r.useRef)(),i=Object(r.useState)(0),o=i[0],s=i[1],u=function(){return s(o+1)};return Object(r.useEffect)((function(){if(void 0===a.current){var r=new l.a(e);null!=t&&t.added&&r.onEntityAdded.connect(t.added),null!=t&&t.removed&&r.onEntityRemoved.connect(t.removed),r.onEntityAdded.connect(u),r.onEntityRemoved.connect(u),n.addQuery(r),a.current=r,u()}}),[]),new p(a)}n(167);var m=n(168);n(169)},173:function(e,t,n){"use strict";n(166);var r=n(174);n.o(r,"rad")&&n.d(t,"rad",(function(){return r.rad}));n(165);var a=n(175);n.d(t,"rad",(function(){return a.a}))},174:function(e,t){},175:function(e,t,n){"use strict";function r(e){return e*Math.PI/180}n.d(t,"a",(function(){return r}))},176:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return b.b})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return j})),n.d(t,"e",(function(){return w}));var r=n(178),a=n(162),i=n(4),o=n(159),c=n(0),s=n.n(c),u=n(170),l=function(e){function t(t){var n;return n=e.call(this,t)||this,Object(o.a)(Object(a.a)(n),"context",void 0),Object(o.a)(Object(a.a)(n),"ref",void 0),n.ref=Object(c.createRef)(),n}Object(i.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.context.add(this)},n.render=function(){if(1!==c.Children.count(this.props.children))throw new Error("<DOMView /> must have a single child.");return s.a.createElement(s.a.Fragment,null,Object(c.cloneElement)(this.props.children,{ref:this.ref}))},Object(r.a)(t,[{key:"element",get:function(){return this.ref.current}}]),t}(c.Component);Object(o.a)(l,"contextType",u.a),l.__componentClassId__=-1;var b=n(160),f=n(164),p=n(167),d=n(169),m={emissionDelay:.1},h=function(e){var t=Object(f.a)(),n=(e=Object.assign({},m,e)).emissionDelay,r=Object(c.useRef)(0),a=e.children,i=Object(p.a)([]),o=i[0],u=i[1];Object(d.a)(n,(function(){var e,t;u([(e=Object(c.createRef)(),t=r.current++,{element:a instanceof Function?Object.assign({},a(),{ref:e,key:t}):Object(c.cloneElement)(a,Object.assign({},{},{ref:e,key:t})),ref:e})].concat(o.current))}));var l=function(e){!function(e){if(e>-1)if(1===o.current.length)u([]);else{var t=o.current.slice(0,e),n=o.current.slice(e+1);u(t.concat(n))}}(o.current.findIndex((function(t){var n;return(null===(n=t.ref.current)||void 0===n?void 0:n.entity.id)===e.id})))};return Object(c.useEffect)((function(){return t.onEntityRemoved.connect(l),function(){t.onEntityRemoved.disconnect(l)}}),[]),s.a.createElement(s.a.Fragment,null,o.current.map((function(e){return e.element})))},y=n(172),O=n(161),j=function(e){function t(t){var n;return n=e.call(this,t)||this,Object(o.a)(Object(a.a)(n),"context",void 0),Object(o.a)(Object(a.a)(n),"entity",void 0),n.entity=new y.Entity,n}Object(i.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.context.engine.addEntity(this.entity)},n.componentWillUnmount=function(){this.entity.clear(),this.entity.invalidate(),this.context.engine.removeEntity(this.entity)},n.render=function(){return s.a.createElement(O.a.Provider,{value:this.entity},this.props.children)},t}(c.Component);Object(o.a)(j,"contextType",b.b);var v=n(190);Object(v.a)({enforceActions:"never"});var g=["props","context","refs","updater","meta"],w=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t=e.call.apply(e,[this].concat(r))||this,Object(o.a)(Object(a.a)(t),"context",void 0),t}Object(i.a)(t,e);var n=t.prototype;return n.createFake=function(){return new(0,Object.getPrototypeOf(this).constructor)},n.getAnnotations=function(e){var t=new Map(Object.getOwnPropertyNames(e).filter((function(e){return!g.includes(e)&&!e.endsWith("Ref")})).map((function(e){return[e,v.c]}))).entries();return Object.fromEntries(t)},n.asComponent=function(){return this},n.componentDidMount=function(){if(this.context){Object.assign(this,this.props);var e=this.createFake(),t=this.getAnnotations(e);Object(v.b)(this,t,{autoBind:!0}),this.context.add(this)}else console.error("Data Component without Entity Context!")},n.render=function(){return Object.assign(this,this.props),null},t}(c.Component);Object(o.a)(w,"contextType",O.a)},183:function(e,t,n){e.exports={example:"example_1hIu",leva:"leva_2JxF"}},185:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(188),a=n(184),i=n(0),o=n.n(i),c=n(3),s=n(182),u=function(e){return o.a.createElement(s.a,Object(c.a)({},s.b,{code:e.code,language:"tsx"}),(function(e){var t=e.className,n=e.style,r=e.tokens,a=e.getLineProps,i=e.getTokenProps;return o.a.createElement("pre",{className:t,style:n},r.map((function(e,t){return o.a.createElement("div",a({line:e,key:t}),e.map((function(e,t){return o.a.createElement("span",i({token:e,key:t}))})))})))}))},l=n(183),b=n.n(l),f=function(e){return o.a.createElement("div",{style:{flex:1,display:"flex",alignItems:"stretch",flexDirection:"column"}},o.a.createElement("div",{className:b.a.leva,style:{top:"75px",display:e.hideControls?"none":"block"}},o.a.createElement(a.a,{fill:!0,collapsed:e.collapsed})),o.a.createElement("div",{className:b.a.example,style:Object.assign({marginBottom:"1em",position:"relative",overflow:"hidden",padding:"1em"},e.style||{})},o.a.createElement(r.a,{fallback:o.a.createElement("div",null)},(function(){return o.a.createElement(i.Suspense,{fallback:o.a.createElement("div",null)},e.children)}))),e.code&&o.a.createElement(u,{code:e.code}))}},201:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var r=n(162),a=n(159),i=n(4),o=n(163),c=n(184),s=n(0),u=n.n(s),l=n(179),b=function(e){function t(){return e.apply(this,arguments)||this}return Object(i.a)(t,e),t}(o.Facet),f=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,Object(a.a)(Object(r.a)(t),"timeleft",1),t}return Object(i.a)(t,e),t}(o.Facet),p=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,Object(a.a)(Object(r.a)(t),"location",new l.Vector2(0,0)),t}return Object(i.a)(t,e),t}(o.Facet),d=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,Object(a.a)(Object(r.a)(t),"amount",new l.Vector2(0,0)),t}return Object(i.a)(t,e),t}(o.Facet),m=function(){var e=Object(o.useEngine)(),t=Object(o.useQuery)((function(e){return e.has(f)}));return Object(o.useSystem)((function(n){t.loop([f],(function(t,r){var a=r[0];a.timeleft-=n,a.timeleft<=0&&e.removeEntity(t)}))}))},h=function(){var e=Object(o.useQuery)((function(e){return e.hasAll(p,d)}));return Object(o.useSystem)((function(t){e.loop([p,d],(function(e,t){var n=t[0],r=t[1];n.location=n.location.clone().add(r.amount)}))}))},y=function(e){var t=e.vector,n=Object(o.useQuery)((function(e){return e.hasAll(b,d)}));return Object(o.useSystem)((function(e){n.loop([d],(function(n,r){var a=r[0];a.amount=a.amount.clone().add(t.clone().multiplyScalar(e))}))}))},O=function(){var e=Object(o.useQuery)((function(e){return e.hasAll(o.DOMView,p)}));return Object(o.useSystem)((function(t){e.loop([o.DOMView,p],(function(e,t){var n=t[0],r=t[1];n.element.style.left=r.location.x+"px",n.element.style.top=r.location.y+"px"}))}))},j=function(){var e=Object(o.useECS)();Object(o.useAnimationFrame)(e.update);var t=Object(s.useRef)(),n=Object(c.b)("particles",{sizeRange:{value:[16,32],min:1,max:256},offset:{value:50,max:300,min:20},delay:{value:.05,min:.01,max:.2},strength:{value:10,min:1,max:50},gravity:{value:{x:0,y:10}},lifetime:{value:[1,3],min:.1,max:5}}),r=n.sizeRange,a=n.offset,i=n.delay,j=n.strength,v=n.gravity,g=n.lifetime,w=function(e){return Math.random()*e-.5*e},E=function(e){return new l.Vector2(w(e),w(e))};return u.a.createElement("div",{ref:t},u.a.createElement(e.Provider,null,u.a.createElement(m,null),u.a.createElement(h,null),u.a.createElement(y,{vector:new l.Vector2(v.x,v.y)}),u.a.createElement(O,null),u.a.createElement(o.Emitter,{emissionDelay:i},(function(){var e=r[0]+Math.random()*r[1],n=E(a).add(new l.Vector2(t.current.offsetWidth/2,t.current.offsetHeight/2)).subScalar(e/2);return u.a.createElement(o.Entity,null,u.a.createElement(b,null),u.a.createElement(f,{timeleft:g[0]+Math.random()*g[1]}),u.a.createElement(p,{location:n}),u.a.createElement(d,{amount:E(j)}),u.a.createElement(o.DOMView,null,u.a.createElement("img",{style:{position:"absolute",left:n.x,top:n.y,width:e,height:e},alt:"smiley face",src:"https://i.imgur.com/kFjaH5l.png"})))}))))}},209:function(e,t,n){"use strict";t.a="import {\n    DOMView,\n    Emitter,\n    Entity,\n    Facet,\n    useAnimationFrame,\n    useECS,\n    useEngine,\n    useQuery,\n    useSystem\n} from '@react-ecs/core';\nimport { useControls } from 'leva';\nimport React, { useRef } from 'react';\nimport { Vector2 } from 'three';\n\nclass Mass extends Facet<Mass> { }\n\nclass Lifetime extends Facet<Lifetime> {\n    timeleft?= 1;\n}\n\nclass Position extends Facet<Position> {\n    location?= new Vector2(0, 0)\n}\n\nclass Velocity extends Facet<Velocity> {\n    amount?= new Vector2(0, 0)\n}\n\nconst LifetimeSystem = () => {\n    const engine = useEngine()\n    const query = useQuery(e => e.has(Lifetime));\n\n    return useSystem((dt: number) => {\n        query.loop([Lifetime], (e, [lifetime]) => {\n            lifetime.timeleft -= dt;\n\n            if (lifetime.timeleft <= 0) {\n                engine.removeEntity(e);\n            }\n        });\n    });\n};\n\nconst PhysicsSystem = () => {\n    const query = useQuery(e => e.hasAll(Position, Velocity))\n\n    return useSystem((dt) => {\n        query.loop([Position, Velocity], (e, [pos, vel]) => {\n            pos.location = pos.location.clone().add(vel.amount)\n        })\n    })\n}\n\nconst GravitySystem = ({ vector }) => {\n    const query = useQuery(e => e.hasAll(Mass, Velocity))\n\n    return useSystem((dt) => {\n        query.loop([Velocity], (e, [vel]) => {\n            vel.amount = vel.amount.clone().add(vector.clone().multiplyScalar(dt));\n        })\n    })\n}\n\nconst DOMViewSystem = () => {\n    const query = useQuery(e => e.hasAll(DOMView, Position))\n\n    return useSystem((dt) => {\n        query.loop([DOMView, Position], (e, [view, pos]) => {\n            view.element.style.left = `${pos.location.x}px`;\n            view.element.style.top = `${pos.location.y}px`;\n        });\n    })\n}\n\nexport const DOMParticles = () => {\n    const ECS = useECS();\n    useAnimationFrame(ECS.update);\n\n    const containerRef = useRef<HTMLDivElement>();\n\n    const { sizeRange, offset, delay, strength, gravity, lifetime } = useControls('particles', {\n        sizeRange: {\n            value: [16, 32],\n            min: 1,\n            max: 256,\n        },\n        offset: {\n            value: 50,\n            max: 300,\n            min: 20,\n        },\n        delay: {\n            value: .05,\n            min: 0.01,\n            max: .2\n        },\n        strength: {\n            value: 10,\n            min: 1,\n            max: 50\n        },\n        gravity: {\n            value: { x: 0, y: 10 }\n        },\n        lifetime: {\n            value: [1, 3],\n            min: .1,\n            max: 5,\n        }\n    })\n\n    const rnd = (s: number) =>\n        Math.random() * s - s * 0.5;\n    const randomVector = (s: number) =>\n        new Vector2(rnd(s), rnd(s));\n    const rndPos = () =>\n        randomVector(offset).add(new Vector2(\n            containerRef.current.offsetWidth / 2,\n            containerRef.current.offsetHeight / 2,\n        ))\n\n    return (\n        <div ref={containerRef}>\n            <ECS.Provider>\n                <LifetimeSystem />\n                <PhysicsSystem />\n                <GravitySystem vector={new Vector2(gravity.x, gravity.y)} />\n                <DOMViewSystem />\n\n                <Emitter emissionDelay={delay}>\n                    {() => {\n                        const size = sizeRange[0] + (Math.random() * sizeRange[1])\n                        const pos = rndPos().subScalar(size / 2)\n                        return (\n                            <Entity>\n                                <Mass />\n                                <Lifetime timeleft={lifetime[0] + Math.random() * lifetime[1]} />\n                                <Position location={pos} />\n                                <Velocity amount={randomVector(strength)} />\n                                <DOMView>\n                                    <img\n                                        style={{\n                                            position: 'absolute',\n                                            left: pos.x,\n                                            top: pos.y,\n                                            width: size,\n                                            height: size\n                                        }}\n                                        alt=\"smiley face\"\n                                        src=\"https://i.imgur.com/kFjaH5l.png\" />\n                                </DOMView>\n                            </Entity>\n                        );\n                    }}\n                </Emitter>\n            </ECS.Provider>\n        </div>\n    )\n}\n"}}]);