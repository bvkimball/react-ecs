(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{146:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return V})),n.d(t,"metadata",(function(){return B})),n.d(t,"toc",(function(){return L})),n.d(t,"default",(function(){return I}));var r=n(3),a=n(7),i=n(0),o=n.n(i),c=n(159),u=n(186),s=n(204),l=n(162),d=n(178),f=n(288),m=n(289),h=n(290),p=n(193),b=n(256),v=n.n(b),g=n(179),j=n(164),O=n(160),y=n(4),E=function(e){function t(){return e.apply(this,arguments)||this}return Object(y.a)(t,e),t}(l.Facet),w=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,Object(O.a)(Object(j.a)(t),"sign",void 0),Object(O.a)(Object(j.a)(t),"dot",void 0),Object(O.a)(Object(j.a)(t),"distance",void 0),t}return Object(y.a)(t,e),t}(l.Facet),x=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,Object(O.a)(Object(j.a)(t),"organism",void 0),Object(O.a)(Object(j.a)(t),"network",void 0),t}return Object(y.a)(t,e),t}(l.Facet),S=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,Object(O.a)(Object(j.a)(t),"amount",0),t}return Object(y.a)(t,e),t}(l.Facet),z=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,Object(O.a)(Object(j.a)(t),"amount",0),t}return Object(y.a)(t,e),t}(l.Facet),C=n(286),M=function(){var e=this;Object(O.a)(this,"config",void 0),Object(O.a)(this,"nodes",void 0),Object(O.a)(this,"connections",void 0),Object(O.a)(this,"population",void 0),this.config=Object.assign({},C.b,{populationSize:100,adjustCompatibilityThreshold:!0,compatibilityModifierTarget:30,feedForwardOnly:!0});var t=[new C.c(C.d.Input,"angle"),new C.c(C.d.Input,"sign"),new C.c(C.d.Input,"distance")],n=[new C.c(C.d.Output,"turnAmount"),new C.c(C.d.Output,"thrustAmount")];this.nodes=[].concat(t,n),this.connections=[],t.forEach((function(t,r){n.forEach((function(n,a){console.log('Connecting: "'+t.id+'" => "'+n.id+'"'),e.connections.push(new C.a(r+1e4*a,t,n))}))})),this.population=C.e.from(this.config,{nodes:this.nodes,connections:this.connections})},R=function(e){var t=e.speed,n=Object(l.useQuery)((function(e){return e.hasAll(d.a,z)}));return Object(l.useSystem)((function(e){n.loop([d.a,z],(function(n,r){var a=r[0],i=r[1].amount,o=a.object3d.rotation;o.y=(o.y+i*e*t)%(2*Math.PI)}))}))},A=function(e){var t=e.speed,n=Object(l.useQuery)((function(e){return e.hasAll(d.a,z,S)}));return Object(l.useSystem)((function(e){n.loop([d.a,z,S],(function(n,r){var a=r[0],i=(r[1],r[2]);a.object3d.translateZ(i.amount*e*t)}))}))},k=function(){var e=Object(l.useQuery)((function(e){return e.hasAll(d.a,E)})),t=Object(l.useQuery)((function(e){return e.hasAll(d.a,x)}));return Object(l.useSystem)((function(n){t.loop([d.a,w],(function(t,n,r){var a=n[0],i=n[1],o=void 0;e.loop([d.a],(function(e,t){var n=t[0],r=a.object3d.position.distanceTo(n.object3d.position);(void 0===o||r<o.dist)&&(o={dist:r,view:n})}));var c=a.object3d,u=o.view.object3d,s=(new g.Vector3).subVectors(u.position,c.position).normalize(),l=new g.Vector3,f=new g.Vector3;c.getWorldDirection(l),l.normalize(),f.crossVectors(l,s),i.dot=(l.dot(s)+1)/2,i.distance=c.position.distanceTo(u.position)/200,i.sign=f.y}))}))},T=function(){var e=Object(i.useRef)(),t=Object(i.useRef)(0),n=Object(i.useRef)(0),r=Object(l.useQuery)((function(e){return e.hasAll(x,d.a,z,S)})),a=function(){if(console.log("Resetting to tick 0."),t.current=0,n.current>0){console.log("New epoch: "+n.current+".");var a=v.a.max(r.entities.filter((function(e){return e.get(x).organism})).map((function(e){return e.get(x).organism.fitness})));console.log("Max fitness: "+a),r.loop([x],(function(e,t){var n=t[0];void 0!==n.organism&&(n.organism.fitness=a>0?n.organism.fitness/a:0)})),e.current.population.epoch(),console.log("Population: "+e.current.population.organisms.length)}e.current.population.getSuperChamp().getNetwork().neurons.values(),r.loop([x,d.a,z,S],(function(t,n,r){var a=n[0],i=n[1],o=n[2],c=n[3];i.object3d.material.color=new g.Color("green"),a.organism=e.current.population.organisms[r],a.organism?(a.network=a.organism.getNetwork(),i.object3d.scale.set(1,1,2),i.object3d.position.set(200*Math.random()-100,0,200*Math.random()-100)):(a.network=void 0,o.amount=0,c.amount=0,i.object3d.position.set(0,1e4,0))})),n.current++};return Object(i.useEffect)((function(){e.current=new M,a()}),[]),Object(l.useSystem)((function(e){t.current>500&&a(),r.loop([x,w,z,S],(function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3];if(!r.network)return i.amount=0,void(o.amount=0);var c=r.network.activate([a.dot,a.sign,a.distance]),u=c[0],s=c[1];i.amount=2*u.value-1,o.amount=2*s.value-1})),t.current++}))},F=function(){var e=Object(l.useQuery)((function(e){return e.hasAll(d.a,E)})),t=Object(l.useQuery)((function(e){return e.hasAll(d.a,x)}));return Object(l.useSystem)((function(n){t.loop([d.a,x],(function(t,n){var r=n[0],a=n[1];e.loop([d.a,E],(function(e,t){var n=t[0];t[1];r.object3d.position.distanceTo(n.object3d.position)<1&&(a.organism.fitness++,r.object3d.material.color.b+=10,r.object3d.scale.z+=1,n.object3d.position.set(200*Math.random()-100,0,200*Math.random()-100))}))}))}))},P=function(e){return o.a.createElement(l.Entity,null,o.a.createElement(w,null),o.a.createElement(x,null),o.a.createElement(z,null),o.a.createElement(S,null),o.a.createElement(s.d,null),o.a.createElement(d.a,null,o.a.createElement(f.a,{position:e.position,scale:[1,1,2],castShadow:!0,receiveShadow:!0},o.a.createElement("meshPhongMaterial",{color:"green"}))))},D=function(){var e=Object(i.useRef)();return Object(m.a)(e,g.DirectionalLightHelper,"royalblue",1),Object(m.a)(e,g.DirectionalLightShadow),o.a.createElement("directionalLight",{ref:e,position:[10,10,10],castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":100,"shadow-camera-left":-100,"shadow-camera-right":100,"shadow-camera-top":100,"shadow-camera-bottom":-100})},_=function(){var e=Object(l.useECS)();return Object(l.useAnimationFrame)(e.update),o.a.createElement(p.a,{shadows:!0},o.a.createElement(D,null),o.a.createElement(h.a,{minDistance:30,maxPolarAngle:Object(l.rad)(60),minPolarAngle:Object(l.rad)(20)}),o.a.createElement(f.a,{scale:[200,1,200],position:[0,-1,0],receiveShadow:!0},o.a.createElement("meshPhongMaterial",{color:"lightblue"})),o.a.createElement(e.Provider,null,o.a.createElement(k,null),o.a.createElement(T,null),o.a.createElement(R,{speed:5}),o.a.createElement(A,{speed:10}),o.a.createElement(F,null),o.a.createElement(s.c,{showBounds:!0,size:100}),b.times(500,(function(){return o.a.createElement(l.Entity,null,o.a.createElement(E,null),o.a.createElement(d.a,null,o.a.createElement(f.b,{position:[200*Math.random()-100,0,200*Math.random()-100]},o.a.createElement("meshPhongMaterial",{color:"blue"}))))})),b.times(100,(function(){return o.a.createElement(P,{position:[200*Math.random()-100,0,200*Math.random()-100]})}))))},V={sidebar_position:3,sidebar_label:"Eater Experiment",title:"Eater Experiment"},B={unversionedId:"three/EaterExample",id:"three/EaterExample",isDocsHomePage:!1,title:"Eater Experiment",description:"",source:"@site/examples/three/EaterExample.md",sourceDirName:"three",slug:"/three/EaterExample",permalink:"/examples/three/EaterExample",version:"current",sidebar_label:"Eater Experiment",sidebarPosition:3,frontMatter:{sidebar_position:3,sidebar_label:"Eater Experiment",title:"Eater Experiment"},sidebar:"mySidebar",previous:{title:"Boids",permalink:"/examples/three/BoidExample"}},L=[],Q={toc:L};function I(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(c.b)("wrapper",Object(r.a)({},Q,n,{components:t,mdxType:"MDXLayout"}),Object(c.b)(u.a,{code:"import {\n    Teleporter,\n    Teleporting\n} from '@react-ecs/boids';\nimport {\n    Entity,\n    rad,\n    useAnimationFrame,\n    useECS\n} from '@react-ecs/core';\nimport { ThreeView } from '@react-ecs/three';\nimport {\n    Box,\n    OrbitControls,\n    Sphere,\n    useHelper\n} from '@react-three/drei';\nimport { Canvas } from '@react-three/fiber';\nimport * as _ from 'lodash';\nimport React, { useRef } from 'react';\nimport {\n    DirectionalLightHelper,\n    DirectionalLightShadow\n} from 'three';\n\nimport {\n    Rewarding,\n    Sensing,\n    Thinking,\n    Thrusting,\n    Turning\n} from './facets';\nimport { RewardSystem, SensingSystem, ThinkingSystem, ThrustingSystem, TurningSystem } from './systems';\n\nconst Eater = (props) => {\n    return (\n        <Entity>\n            <Sensing />\n            <Thinking />\n            <Turning />\n            <Thrusting />\n            <Teleporting />\n            <ThreeView>\n                <Box position={props.position} scale={[1, 1, 2]} castShadow receiveShadow>\n                    <meshPhongMaterial color=\"green\" />\n                </Box>\n            </ThreeView>\n\n        </Entity>\n    )\n}\n\nconst Scene = () => {\n    const lightRef = useRef()\n    useHelper(lightRef, DirectionalLightHelper, 'royalblue', 1)\n    useHelper(lightRef, DirectionalLightShadow, )\n    return (\n        <directionalLight\n            ref={lightRef}\n            position={[10, 10, 10]}\n            castShadow\n            shadow-mapSize-width={2048}\n            shadow-mapSize-height={2048}\n            shadow-camera-far={100}\n            shadow-camera-left={-100}\n            shadow-camera-right={100}\n            shadow-camera-top={100}\n            shadow-camera-bottom={-100}\n        />\n    );\n}\n\nexport const EaterScene = () => {\n    const ECS = useECS()\n    useAnimationFrame(ECS.update)\n\n    return (\n        <Canvas shadows>\n            <Scene />\n            <OrbitControls\n                minDistance={30}\n                maxPolarAngle={rad(60)}\n                minPolarAngle={rad(20)} />\n            <Box scale={[200, 1, 200]} position={[0, -1, 0]} receiveShadow>\n                <meshPhongMaterial color='lightblue' />\n            </Box>\n            <ECS.Provider>\n                <SensingSystem />\n                <ThinkingSystem />\n                <TurningSystem speed={5} />\n                <ThrustingSystem speed={10} />\n                <RewardSystem />\n                <Teleporter showBounds size={100} />\n\n                {_.times(500, () => (\n                    <Entity>\n                        <Rewarding />\n                        <ThreeView>\n                            <Sphere position={[Math.random() * 200 - 100, 0, Math.random() * 200 - 100]}>\n                                <meshPhongMaterial color='blue' />\n                            </Sphere>\n                        </ThreeView>\n                    </Entity>\n                ))}\n\n                {_.times(100, () => (\n                    <Eater position={[Math.random() * 200 - 100, 0, Math.random() * 200 - 100]} />\n                ))}\n            </ECS.Provider>\n        </Canvas>\n    )\n}\n\n\n\n\n",style:{minHeight:"400px",padding:"1em"},mdxType:"Example"},Object(c.b)(_,{mdxType:"EaterScene"})))}I.isMDXComponent=!0},161:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return s}));var r=n(160),a=n(0),i=n.n(a),o=n(173),c=n(166),u=Object(a.createContext)(null),s=function(){function e(e,t){var n=this;void 0===e&&(e=[]),void 0===t&&(t=[]),Object(r.a)(this,"engine",new o.Engine),Object(r.a)(this,"systems",new c.a),this.update=this.update.bind(this),this.Provider=this.Provider.bind(this),e.forEach((function(e){return n.systems.add(e)})),t.forEach((function(e){return n.engine.addEntity(e)}))}var t=e.prototype;return t.update=function(e){this.systems.update(e)},t.Provider=function(e){return i.a.createElement(u.Provider,{value:this},e.children)},e}()},162:function(e,t,n){"use strict";var r=n(177);n.d(t,"DOMView",(function(){return r.a})),n.d(t,"ECSContext",(function(){return r.b})),n.d(t,"Emitter",(function(){return r.c})),n.d(t,"Entity",(function(){return r.d})),n.d(t,"Facet",(function(){return r.e}));var a=n(171);n.d(t,"EntityContext",(function(){return a.a})),n.d(t,"useAnimationFrame",(function(){return a.b})),n.d(t,"useECS",(function(){return a.c})),n.d(t,"useEngine",(function(){return a.d})),n.d(t,"useFacet",(function(){return a.e})),n.d(t,"useQuery",(function(){return a.f})),n.d(t,"useSystem",(function(){return a.g}));var i=n(174);n.o(i,"rad")&&n.d(t,"rad",(function(){return i.rad}))},163:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var r=n(0),a=Object(r.createContext)(null);function i(){var e=Object(r.useContext)(a);if(!e)throw new Error("Missing Entity instance in EntityContext!");return e}},165:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),a=n(161),i=function(){return Object(r.useContext)(a.b).engine}},166:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(160),a=function(){function e(){Object(r.a)(this,"systems",void 0),this.systems=new Array}var t=e.prototype;return t.sort=function(){this.systems.sort((function(e,t){return e.priority-t.priority}))},t.add=function(e,t){void 0===t&&(t=0),this.systems.push({callback:e,priority:t}),this.sort()},t.remove=function(e){var t=this.systems.findIndex((function(t){return t.callback===e}));return t>-1&&(this.systems.splice(t,1),this.sort(),!0)},t.clear=function(){this.systems=[]},t.update=function(e){this.systems.forEach((function(t){return t.callback(e)}))},e}()},167:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(181),a=n(4),i=n(173),o=function(e){function t(){return e.apply(this,arguments)||this}return Object(a.a)(t,e),t.prototype.loop=function(e,t){for(var n=0;n<this.entities.length;n++){for(var a,i=this.entities[n],o=[],c=Object(r.a)(e);!(a=c()).done;){var u=a.value,s=i.get(u);o.push(s)}t(i,o,n)}},t}(i.Query)},168:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0);function a(e){var t=Object(r.useRef)(e),n=Object(r.useState)({current:e}),a=(n[0],n[1]);return[t,function(e){t.current=e,a({current:e})}]}},169:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),a=n(161),i=function(e,t){void 0===t&&(t=0);var n=Object(r.useContext)(a.b).systems;return Object(r.useEffect)((function(){return n.add(e,t),function(){n.remove(e)}}),[e,t]),null}},170:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),a=n(169),i=function(e,t){var n=Object(r.useRef)(0);Object(a.a)((function(r){n.current+=r,n.current>e&&(n.current=0,t())}))}},171:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return c.a})),n.d(t,"a",(function(){return u.a})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return h})),n.d(t,"g",(function(){return p.a}));var r=n(0),a=function(e){var t=Object(r.useRef)(null),n=Object(r.useRef)(null),a=function r(a){if(null!=n.current){var i=a-n.current;e(i/1e3)}n.current=a,t.current=requestAnimationFrame(r)};Object(r.useEffect)((function(){return t.current=requestAnimationFrame(a),function(){return cancelAnimationFrame(t.current)}}),[])},i=n(161);function o(){var e=Object(r.useState)((function(){return new i.a}))[0];return Object(r.useEffect)((function(){"undefined"!=typeof window&&(window.ecs=e)})),e}var c=n(165),u=n(163);function s(e){var t=Object(u.b)(),n=Object(r.useState)(new e),a=n[0],i=n[1];return Object(r.useEffect)((function(){var n=t.get(e);n?i(n):console.error("Couldn't find facet on entity: "+e.prototype.constructor.name)})),a}var l=n(167),d=n(180),f=n(160),m=function(){function e(e){Object(f.a)(this,"ref",void 0),this.ref=e}var t=e.prototype;return t.loop=function(e,t){if(this.current)return this.current.loop(e,t)},t.countBy=function(e){return this.current?this.current.countBy(e):0},t.filter=function(e){return this.current?this.current.filter(e):[]},t.has=function(e){return!!this.current&&this.current.has(e)},t.clear=function(){if(this.current)return this.current.clear()},Object(d.a)(e,[{key:"current",get:function(){return this.ref.current}},{key:"entities",get:function(){if(this.current)return this.current.entities}},{key:"first",get:function(){if(this.current)return this.current.first}},{key:"last",get:function(){if(this.current)return this.current.last}},{key:"length",get:function(){if(this.current)return this.current.length}},{key:"isEmpty",get:function(){return!this.current||this.current.isEmpty}}]),e}();function h(e,t){var n=Object(c.a)(),a=Object(r.useRef)(),i=Object(r.useState)(0),o=i[0],u=i[1],s=function(){return u(o+1)};return Object(r.useEffect)((function(){if(void 0===a.current){var r=new l.a(e);null!=t&&t.added&&r.onEntityAdded.connect(t.added),null!=t&&t.removed&&r.onEntityRemoved.connect(t.removed),r.onEntityAdded.connect(s),r.onEntityRemoved.connect(s),n.addQuery(r),a.current=r,s()}}),[]),new m(a)}n(168);var p=n(169);n(170)},174:function(e,t,n){"use strict";n(167);var r=n(175);n.o(r,"rad")&&n.d(t,"rad",(function(){return r.rad}));n(166);var a=n(176);n.d(t,"rad",(function(){return a.a}))},175:function(e,t){},176:function(e,t,n){"use strict";function r(e){return e*Math.PI/180}n.d(t,"a",(function(){return r}))},177:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d.b})),n.d(t,"c",(function(){return b})),n.d(t,"d",(function(){return j})),n.d(t,"e",(function(){return E}));var r=n(180),a=n(164),i=n(4),o=n(160),c=n(0),u=n.n(c),s=n(171),l=function(e){function t(t){var n;return n=e.call(this,t)||this,Object(o.a)(Object(a.a)(n),"context",void 0),Object(o.a)(Object(a.a)(n),"ref",void 0),n.ref=Object(c.createRef)(),n}Object(i.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.context.add(this)},n.render=function(){if(1!==c.Children.count(this.props.children))throw new Error("<DOMView /> must have a single child.");return u.a.createElement(u.a.Fragment,null,Object(c.cloneElement)(this.props.children,{ref:this.ref}))},Object(r.a)(t,[{key:"element",get:function(){return this.ref.current}}]),t}(c.Component);Object(o.a)(l,"contextType",s.a),l.__componentClassId__=-1;var d=n(161),f=n(165),m=n(168),h=n(170),p={emissionDelay:.1},b=function(e){var t=Object(f.a)(),n=(e=Object.assign({},p,e)).emissionDelay,r=Object(c.useRef)(0),a=e.children,i=Object(m.a)([]),o=i[0],s=i[1];Object(h.a)(n,(function(){var e,t;s([(e=Object(c.createRef)(),t=r.current++,{element:a instanceof Function?Object.assign({},a(),{ref:e,key:t}):Object(c.cloneElement)(a,Object.assign({},{},{ref:e,key:t})),ref:e})].concat(o.current))}));var l=function(e){!function(e){if(e>-1)if(1===o.current.length)s([]);else{var t=o.current.slice(0,e),n=o.current.slice(e+1);s(t.concat(n))}}(o.current.findIndex((function(t){var n;return(null===(n=t.ref.current)||void 0===n?void 0:n.entity.id)===e.id})))};return Object(c.useEffect)((function(){return t.onEntityRemoved.connect(l),function(){t.onEntityRemoved.disconnect(l)}}),[]),u.a.createElement(u.a.Fragment,null,o.current.map((function(e){return e.element})))},v=n(173),g=n(163),j=function(e){function t(t){var n;return n=e.call(this,t)||this,Object(o.a)(Object(a.a)(n),"context",void 0),Object(o.a)(Object(a.a)(n),"entity",void 0),n.entity=new v.Entity,n}Object(i.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.context.engine.addEntity(this.entity)},n.componentWillUnmount=function(){this.entity.clear(),this.entity.invalidate(),this.context.engine.removeEntity(this.entity)},n.render=function(){return u.a.createElement(g.a.Provider,{value:this.entity},this.props.children)},t}(c.Component);Object(o.a)(j,"contextType",d.b);var O=n(195);Object(O.a)({enforceActions:"never"});var y=["props","context","refs","updater","meta"],E=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t=e.call.apply(e,[this].concat(r))||this,Object(o.a)(Object(a.a)(t),"context",void 0),t}Object(i.a)(t,e);var n=t.prototype;return n.createFake=function(){return new(0,Object.getPrototypeOf(this).constructor)},n.getAnnotations=function(e){var t=new Map(Object.getOwnPropertyNames(e).filter((function(e){return!y.includes(e)&&!e.endsWith("Ref")})).map((function(e){return[e,O.c]}))).entries();return Object.fromEntries(t)},n.asComponent=function(){return this},n.componentDidMount=function(){if(this.context){Object.assign(this,this.props);var e=this.createFake(),t=this.getAnnotations(e);Object(O.b)(this,t,{autoBind:!0}),this.context.add(this)}else console.error("Data Component without Entity Context!")},n.render=function(){return Object.assign(this,this.props),null},t}(c.Component);Object(o.a)(E,"contextType",g.a)},178:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(180),a=n(164),i=n(4),o=n(160),c=n(162),u=n(0),s=n.n(u),l=function(e){function t(t){var n;return n=e.call(this,t)||this,Object(o.a)(Object(a.a)(n),"context",void 0),Object(o.a)(Object(a.a)(n),"ref",void 0),n.ref=Object(u.createRef)(),n}Object(i.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.context.add(this)},n.render=function(){if(1!==u.Children.count(this.props.children))throw new Error("<ThreeView /> must have a single child.");return s.a.createElement(s.a.Fragment,null,s.a.cloneElement(this.props.children,{ref:this.ref}))},Object(r.a)(t,[{key:"object3d",get:function(){return this.ref.current}}]),t}(u.Component);Object(o.a)(l,"contextType",c.EntityContext),l.__componentClassId__=100},184:function(e,t,n){e.exports={example:"example_1hIu",leva:"leva_2JxF"}},186:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(189),a=n(185),i=n(0),o=n.n(i),c=n(3),u=n(183),s=function(e){return o.a.createElement(u.a,Object(c.a)({},u.b,{code:e.code,language:"tsx"}),(function(e){var t=e.className,n=e.style,r=e.tokens,a=e.getLineProps,i=e.getTokenProps;return o.a.createElement("pre",{className:t,style:n},r.map((function(e,t){return o.a.createElement("div",a({line:e,key:t}),e.map((function(e,t){return o.a.createElement("span",i({token:e,key:t}))})))})))}))},l=n(184),d=n.n(l),f=function(e){return o.a.createElement("div",{style:{flex:1,display:"flex",alignItems:"stretch",flexDirection:"column"}},o.a.createElement("div",{className:d.a.leva,style:{top:"75px",display:e.hideControls?"none":"block"}},o.a.createElement(a.a,{fill:!0,collapsed:e.collapsed})),o.a.createElement("div",{className:d.a.example,style:Object.assign({marginBottom:"1em",position:"relative",overflow:"hidden",padding:"1em"},e.style||{})},o.a.createElement(r.a,{fallback:o.a.createElement("div",null)},(function(){return o.a.createElement(i.Suspense,{fallback:o.a.createElement("div",null)},e.children)}))),e.code&&o.a.createElement(s,{code:e.code}))}},204:function(e,t,n){"use strict";n.d(t,"a",(function(){return S})),n.d(t,"b",(function(){return M})),n.d(t,"c",(function(){return v})),n.d(t,"d",(function(){return p}));var r=n(288),a=n(185),i=n(0),o=n.n(i),c=n(164),u=n(4),s=n(160),l=n(162),d=n(179),f=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,Object(s.a)(Object(c.a)(t),"amount",new d.Vector3(0,0,0)),t}return Object(u.a)(t,e),t}(l.Facet),m=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,Object(s.a)(Object(c.a)(t),"meta",{neighbors:[]}),t}return Object(u.a)(t,e),t}(l.Facet),h=n(178),p=function(e){function t(){return e.apply(this,arguments)||this}return Object(u.a)(t,e),t}(l.Facet),b=function(e){var t=Object(l.useQuery)((function(e){return e.hasAll(h.a,p)}));return Object(l.useSystem)((function(n){t.loop([h.a],(function(t,n){var r=n[0].object3d.position;r.x<-e.size?r.setX(e.size):r.x>e.size&&r.setX(-e.size),r.y<-e.size?r.setY(e.size):r.y>e.size&&r.setY(-e.size),r.z<-e.size?r.setZ(e.size):r.z>e.size&&r.setZ(-e.size)}))}))},v=function(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement(b,{size:e.size}),e.showBounds&&o.a.createElement(o.a.Fragment,null,o.a.createElement(r.a,{scale:3}),o.a.createElement(r.a,{position:[e.size,e.size,e.size]}),o.a.createElement(r.a,{position:[-e.size,-e.size,-e.size]}),o.a.createElement(r.a,{position:[e.size,-e.size,e.size]}),o.a.createElement(r.a,{position:[-e.size,e.size,-e.size]}),o.a.createElement(r.a,{position:[e.size,e.size,-e.size]}),o.a.createElement(r.a,{position:[-e.size,-e.size,e.size]}),o.a.createElement(r.a,{position:[e.size,-e.size,-e.size]}),o.a.createElement(r.a,{position:[-e.size,e.size,e.size]})))};(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,Object(s.a)(Object(c.a)(t),"targetView",void 0),Object(s.a)(Object(c.a)(t),"pointerRef",void 0),t}return Object(u.a)(t,e),t}(l.Facet)).__componentClassId__=99;var g=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,Object(s.a)(Object(c.a)(t),"amount",new d.Vector3(Math.random()-.5,Math.random()-.5,Math.random()-.5)),t}return Object(u.a)(t,e),t}(l.Facet),j=n(181),O=function(e){var t=Object(l.useQuery)((function(e){return e.hasAll(m,g,f)}));return Object(l.useSystem)((function(n){t.loop([m,g,f],(function(t,n){for(var r,a=n[0],i=n[1],o=n[2],c=new d.Vector3(0,0,0),u=a.meta.neighbors,s=Object(j.a)(a.meta.neighbors);!(r=s()).done;){var l=r.value.get(g).amount;c.add(l)}u.length&&(c.divideScalar(u.length),c.sub(i.amount),c.clampLength(e.min||0,e.max||1)),o.amount=c.normalize().clone().multiplyScalar(e.amount)}))}))},y=function(e){var t=Object(l.useQuery)((function(e){return e.hasAll(h.a,g,m)}));return Object(l.useSystem)((function(n){t.loop([h.a,m,g,f],(function(t,n){for(var r,a=n[0],i=n[1],o=n[2],c=n[3],u=a.object3d,s=new d.Vector3,l=i.meta.neighbors,f=Object(j.a)(l);!(r=f()).done;){var m=r.value;s.add(m.get(h.a).object3d.position)}l.length&&(s.divideScalar(l.length),s.sub(u.position),s.setLength(1),s.sub(o.amount),s.clampLength(e.min,e.max),s.multiplyScalar(e.amount)),c.amount.add(s)}))}))},E=function(e){var t=Object(l.useQuery)((function(e){return e.hasAll(h.a,g,f)}));return Object(l.useSystem)((function(n){null==t||t.loop([h.a,g,f],(function(t,r){var a=r[0],i=r[1],o=r[2],c=a.object3d;if(i.amount.length()>0){var u=c.position.clone().add(i.amount);c.lookAt(u)}var s=c.position.clone().add(i.amount.clone().multiplyScalar(n));i.amount.add(o.amount),i.amount.clampLength(e.min,e.max),c.position.copy(s)}))}))},w=(l.Facet,new d.LineBasicMaterial({color:new d.Color(Math.random(),Math.random(),Math.random())}),new d.Vector3,function(e){var t=Object(l.useQuery)((function(e){return e.hasAll(h.a,m)}));return Object(l.useSystem)((function(n){t.loop([h.a,m],(function(n,r){var a=r[0],i=r[1],o=a.object3d,c=function(e){return o.position.distanceTo(function(e){return e.get(h.a).object3d}(e).position)};i.meta.neighbors=t.entities.filter((function(e){return e.id!==n.id})).filter((function(t){return!e.filter||e.filter(n,t)})).filter((function(t){return c(t)<e.radius})).sort((function(e,t){return c(e)-c(t)}))}))}))}),x=function(e){var t=Object(l.useQuery)((function(e){return e.hasAll(h.a,g,m)}));return Object(l.useSystem)((function(n){t.loop([h.a,m,g,f],(function(t,n){for(var r,a=n[0],i=n[1],o=n[2],c=n[3],u=a.object3d,s=new d.Vector3,l=i.meta.neighbors,f=Object(j.a)(l);!(r=f()).done;){var m=r.value.get(h.a).object3d.position,p=u.position.distanceTo(m),b=u.position.clone().sub(m);b.divideScalar(p*p),s.add(b)}l.length&&(s.divideScalar(l.length),s.sub(o.amount),s.clampLength(e.min,e.max),s.multiplyScalar(e.amount)),c.amount.add(s)}))}))},S=function(e){var t=Object(a.b)("sim",{size:{value:100,min:20,max:200},count:{value:250,min:1,max:250},spawnHeight:{value:1,min:0,max:1},neighborRadius:{value:10,min:1,max:50},showBounds:!1},{}),n=t.size,c=t.count,u=t.spawnHeight,s=t.neighborRadius,l=t.showBounds,d=Object(a.b)("alignment",{enabled:!0,multiplier:{value:.1,min:0,max:1},turningRange:{value:[0,.1],min:0,max:1}}),f=Object(a.b)("cohesion",{enabled:!0,multiplier:{value:1,min:0,max:1},speedRange:{value:[0,1],min:0,max:10}}),m=Object(a.b)("separation",{enabled:!0,multiplier:{value:2,min:0,max:2},speedRange:{value:[0,3],min:0,max:10}}),h=Object(a.b)("speed",{range:{value:[15,50],min:0,max:50}}),p=function(){return Math.random()*n*2-n},b=Object(i.useMemo)((function(){for(var t=[],n=0;n<c;n++)t.push(o.a.createElement(i.Suspense,{fallback:o.a.createElement(r.c,null)},o.a.createElement(M,{render:e.render,position:[p(),p()*u,p()]})));return t}),[n,u,c]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(v,{showBounds:l,size:n}),o.a.createElement(w,{radius:s}),o.a.createElement(O,{amount:d.enabled?d.multiplier:0,min:d.turningRange[0],max:d.turningRange[1]}),o.a.createElement(y,{amount:f.enabled?f.multiplier:0,min:f.speedRange[0],max:f.speedRange[1]}),o.a.createElement(x,{amount:m.enabled?m.multiplier:0,min:m.speedRange[0],max:m.speedRange[1]}),o.a.createElement(E,{min:h.range[0],max:h.range[1]}),b)},z=n(3),C=n(7),M=Object(i.forwardRef)((function(e,t){var n=e.render,r=Object(C.a)(e,["render"]);return o.a.createElement(l.Entity,null,o.a.createElement(m,null),o.a.createElement(g,null),o.a.createElement(f,null),o.a.createElement(p,null),o.a.createElement(h.a,null,o.a.createElement("group",Object(z.a)({ref:t},r,{dispose:null}),n())))}))}}]);